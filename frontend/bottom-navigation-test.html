<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº•éƒ¨å¯¼èˆªç»„ä»¶æµ‹è¯•</title>
    <link rel="stylesheet" href="/frontend/css/bottom-navigation.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .test-btn-primary {
            background: #007AFF;
            color: white;
        }
        
        .test-btn-primary:hover {
            background: #0056CC;
        }
        
        .test-btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .test-btn-secondary:hover {
            background: #545b62;
        }
        
        .test-btn-success {
            background: #28a745;
            color: white;
        }
        
        .test-btn-success:hover {
            background: #1e7e34;
        }
        
        .test-btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .test-btn-warning:hover {
            background: #e0a800;
        }
        
        .test-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 12px;
            margin-top: 15px;
            font-size: 13px;
            color: #0c5460;
        }
        
        .status-display {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-output {
            background: #212529;
            color: #28a745;
            border-radius: 6px;
            padding: 12px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #333; margin-bottom: 30px;">
            ğŸ§ª åº•éƒ¨å¯¼èˆªç»„ä»¶æµ‹è¯•
        </h1>
        
        <!-- åŸºç¡€åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">ğŸ“‹ åŸºç¡€åŠŸèƒ½æµ‹è¯•</div>
            <div class="test-controls">
                <button class="test-btn test-btn-primary" onclick="renderStudentNav()">
                    æ¸²æŸ“å­¦ç”Ÿå¯¼èˆª
                </button>
                <button class="test-btn test-btn-primary" onclick="renderParentNav()">
                    æ¸²æŸ“å®¶é•¿å¯¼èˆª
                </button>
                <button class="test-btn test-btn-secondary" onclick="destroyNav()">
                    é”€æ¯å¯¼èˆª
                </button>
                <button class="test-btn test-btn-success" onclick="refreshNav()">
                    åˆ·æ–°å¯¼èˆª
                </button>
            </div>
            <div class="test-info">
                æµ‹è¯•å¯¼èˆªç»„ä»¶çš„åŸºæœ¬æ¸²æŸ“å’Œé”€æ¯åŠŸèƒ½
            </div>
        </div>
        
        <!-- è§’è‰²åˆ‡æ¢æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">ğŸ”„ è§’è‰²åˆ‡æ¢æµ‹è¯•</div>
            <div class="test-controls">
                <button class="test-btn test-btn-warning" onclick="switchToStudent()">
                    åˆ‡æ¢åˆ°å­¦ç”Ÿ
                </button>
                <button class="test-btn test-btn-warning" onclick="switchToParent()">
                    åˆ‡æ¢åˆ°å®¶é•¿
                </button>
                <button class="test-btn test-btn-secondary" onclick="autoDetectRole()">
                    è‡ªåŠ¨æ£€æµ‹è§’è‰²
                </button>
            </div>
            <div class="test-info">
                æµ‹è¯•è§’è‰²åˆ‡æ¢å’Œè‡ªåŠ¨æ£€æµ‹åŠŸèƒ½
            </div>
        </div>
        
        <!-- é¡µé¢æ¿€æ´»æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">âœ¨ æ¿€æ´»çŠ¶æ€æµ‹è¯•</div>
            <div class="test-controls">
                <button class="test-btn test-btn-success" onclick="setActivePage('home')">
                    æ¿€æ´»é¦–é¡µ
                </button>
                <button class="test-btn test-btn-success" onclick="setActivePage('camera')">
                    æ¿€æ´»æ‹ç…§
                </button>
                <button class="test-btn test-btn-success" onclick="setActivePage('errorbook')">
                    æ¿€æ´»é”™é¢˜æœ¬
                </button>
                <button class="test-btn test-btn-success" onclick="setActivePage('study')">
                    æ¿€æ´»å­¦ä¹ è®¡åˆ’
                </button>
                <button class="test-btn test-btn-success" onclick="setActivePage('profile')">
                    æ¿€æ´»æˆ‘çš„
                </button>
            </div>
            <div class="test-info">
                æµ‹è¯•ä¸åŒé¡µé¢çš„æ¿€æ´»çŠ¶æ€æ˜¾ç¤º
            </div>
        </div>
        
        <!-- è°ƒè¯•åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">ğŸ› è°ƒè¯•åŠŸèƒ½æµ‹è¯•</div>
            <div class="test-controls">
                <button class="test-btn test-btn-warning" onclick="toggleDebugMode()">
                    åˆ‡æ¢è°ƒè¯•æ¨¡å¼
                </button>
                <button class="test-btn test-btn-secondary" onclick="showState()">
                    æ˜¾ç¤ºçŠ¶æ€
                </button>
                <button class="test-btn test-btn-secondary" onclick="clearLog()">
                    æ¸…ç©ºæ—¥å¿—
                </button>
            </div>
            <div class="test-info">
                æµ‹è¯•è°ƒè¯•æ¨¡å¼å’ŒçŠ¶æ€æŸ¥çœ‹åŠŸèƒ½
            </div>
        </div>
        
        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div class="test-section">
            <div class="test-title">ğŸ“Š ç»„ä»¶çŠ¶æ€</div>
            <div id="statusDisplay" class="status-display">
                ç‚¹å‡»"æ˜¾ç¤ºçŠ¶æ€"æŒ‰é’®æŸ¥çœ‹å½“å‰ç»„ä»¶çŠ¶æ€
            </div>
        </div>
        
        <!-- æ—¥å¿—è¾“å‡º -->
        <div class="test-section">
            <div class="test-title">ğŸ“ æ“ä½œæ—¥å¿—</div>
            <div id="logOutput" class="log-output">
                ç­‰å¾…æ“ä½œæ—¥å¿—...
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ä¾èµ–æ–‡ä»¶ -->
    <script src="/frontend/js/navigation-config.js"></script>
    <script src="/frontend/js/bottom-navigation.js"></script>
    
    <script>
        // æ—¥å¿—è¾“å‡ºå‡½æ•°
        function log(message) {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            logOutput.innerHTML += `[${timestamp}] ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        // æµ‹è¯•å‡½æ•°
        function renderStudentNav() {
            log('æ¸²æŸ“å­¦ç”Ÿå¯¼èˆª...');
            localStorage.setItem('role', 'student');
            const success = BottomNavigation.render({
                role: 'student',
                currentPage: 'home',
                debug: true
            });
            log(`å­¦ç”Ÿå¯¼èˆªæ¸²æŸ“${success ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
        }
        
        function renderParentNav() {
            log('æ¸²æŸ“å®¶é•¿å¯¼èˆª...');
            localStorage.setItem('role', 'parent');
            const success = BottomNavigation.render({
                role: 'parent',
                currentPage: 'home',
                debug: true
            });
            log(`å®¶é•¿å¯¼èˆªæ¸²æŸ“${success ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
        }
        
        function destroyNav() {
            log('é”€æ¯å¯¼èˆª...');
            BottomNavigation.destroy();
            log('å¯¼èˆªå·²é”€æ¯');
        }
        
        function refreshNav() {
            log('åˆ·æ–°å¯¼èˆª...');
            BottomNavigation.refresh();
            log('å¯¼èˆªå·²åˆ·æ–°');
        }
        
        function switchToStudent() {
            log('åˆ‡æ¢åˆ°å­¦ç”Ÿè§’è‰²...');
            localStorage.setItem('role', 'student');
            BottomNavigation.refresh('student');
            log('å·²åˆ‡æ¢åˆ°å­¦ç”Ÿè§’è‰²');
        }
        
        function switchToParent() {
            log('åˆ‡æ¢åˆ°å®¶é•¿è§’è‰²...');
            localStorage.setItem('role', 'parent');
            BottomNavigation.refresh('parent');
            log('å·²åˆ‡æ¢åˆ°å®¶é•¿è§’è‰²');
        }
        
        function autoDetectRole() {
            log('è‡ªåŠ¨æ£€æµ‹è§’è‰²...');
            const role = getCurrentUserRole();
            log(`æ£€æµ‹åˆ°è§’è‰²: ${role}`);
            BottomNavigation.refresh();
        }
        
        function setActivePage(pageId) {
            log(`è®¾ç½®æ¿€æ´»é¡µé¢: ${pageId}`);
            BottomNavigation.updateActive(pageId);
            log(`é¡µé¢ ${pageId} å·²æ¿€æ´»`);
        }
        
        function toggleDebugMode() {
            const currentState = BottomNavigation.getState();
            const newDebugMode = !currentState.debug;
            log(`åˆ‡æ¢è°ƒè¯•æ¨¡å¼: ${newDebugMode ? 'å¼€å¯' : 'å…³é—­'}`);
            BottomNavigation.setDebugMode(newDebugMode);
            log(`è°ƒè¯•æ¨¡å¼å·²${newDebugMode ? 'å¼€å¯' : 'å…³é—­'}`);
        }
        
        function showState() {
            const state = BottomNavigation.getState();
            const statusDisplay = document.getElementById('statusDisplay');
            statusDisplay.innerHTML = `
                <strong>å½“å‰çŠ¶æ€:</strong><br>
                è§’è‰²: ${state.role}<br>
                å½“å‰é¡µé¢: ${state.currentPage}<br>
                æ˜¯å¦æ¿€æ´»: ${state.isActive}<br>
                è°ƒè¯•æ¨¡å¼: ${state.debug}<br>
                æ›´æ–°æ—¶é—´: ${new Date().toLocaleString()}
            `;
            log('çŠ¶æ€å·²æ›´æ–°');
        }
        
        function clearLog() {
            document.getElementById('logOutput').innerHTML = '';
            log('æ—¥å¿—å·²æ¸…ç©º');
        }
        
        // ç›‘å¬å¯¼èˆªäº‹ä»¶
        document.addEventListener('beforeNavigate', function(e) {
            log(`å‡†å¤‡å¯¼èˆª: ${e.detail.from} â†’ ${e.detail.to} (${e.detail.url})`);
        });
        
        document.addEventListener('afterNavigate', function(e) {
            log(`å¯¼èˆªå®Œæˆ: ${e.detail.from} â†’ ${e.detail.to}`);
        });
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            log('åº•éƒ¨å¯¼èˆªç»„ä»¶ç‰ˆæœ¬: 1.0.0');
            
            // è®¾ç½®æµ‹è¯•ç”¨çš„token
            if (!localStorage.getItem('token')) {
                localStorage.setItem('token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzU3MDAwMDAwfQ.test');
                log('è®¾ç½®æµ‹è¯•token (å­¦ç”Ÿç”¨æˆ·)');
            }
            
            // è‡ªåŠ¨æ¸²æŸ“å­¦ç”Ÿå¯¼èˆªè¿›è¡Œåˆå§‹æµ‹è¯•
            setTimeout(() => {
                renderStudentNav();
            }, 1000);
        });
    </script>
</body>
</html>