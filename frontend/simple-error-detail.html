<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简化版错题详情</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .content {
            padding: 20px;
        }
        .section {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007AFF;
        }
        .loading {
            text-align: center;
            padding: 40px;
        }
        .spinner {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056CC;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>错题详情</h2>
            <div id="errorId">ID: 加载中...</div>
        </div>
        
        <div class="content">
            <!-- 加载状态 -->
            <div id="loadingSection" class="loading">
                <div class="spinner"></div>
                <p>正在加载错题详情...</p>
            </div>
            
            <!-- 错题内容 -->
            <div id="errorContent" style="display: none;">
                <div class="section">
                    <h3 id="subjectTitle">学科</h3>
                    <p><strong>难度:</strong> <span id="difficulty">中等</span></p>
                    <p><strong>状态:</strong> <span id="reviewStatus">未复习</span></p>
                </div>
                
                <div class="section">
                    <h3>题目内容</h3>
                    <p id="questionText">题目内容加载中...</p>
                </div>
                
                <div class="section">
                    <h3>答案对比</h3>
                    <p><strong>你的答案:</strong> <span id="userAnswer">-</span></p>
                    <p><strong>正确答案:</strong> <span id="correctAnswer">-</span></p>
                </div>
                
                <div class="section">
                    <h3>详细解析</h3>
                    <p id="explanation">解析内容加载中...</p>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn" id="reviewBtn" onclick="markAsReviewed()">✅ 标记已复习</button>
                    <button class="btn" onclick="practiceSimilar()">📚 练习相似题</button>
                </div>
            </div>
            
            <div id="statusInfo"></div>
        </div>
    </div>

    <script>
        let errorId = '';
        let errorData = null;
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面DOM加载完成');
            initPage();
        });

        function initPage() {
            console.log('开始初始化页面');
            
            try {
                // 获取错题ID
                const urlParams = new URLSearchParams(window.location.search);
                errorId = urlParams.get('id') || '1'; // 默认为1
                
                console.log('获取到错题ID:', errorId);
                document.getElementById('errorId').textContent = `ID: ${errorId}`;
                
                // 设置测试token
                if (!localStorage.getItem('token')) {
                    localStorage.setItem('token', 'test_token');
                    console.log('设置测试token');
                }
                
                // 延迟加载，模拟网络请求
                setTimeout(() => {
                    loadErrorDetail();
                }, 1000);
                
            } catch (error) {
                console.error('初始化失败:', error);
                showError('初始化失败: ' + error.message);
            }
        }

        function loadErrorDetail() {
            console.log('开始加载错题详情');
            
            try {
                // 生成模拟数据
                const mockData = generateMockData(errorId);
                console.log('生成的模拟数据:', mockData);
                
                // 显示数据
                displayErrorDetail(mockData);
                
            } catch (error) {
                console.error('加载错题详情失败:', error);
                showError('加载失败: ' + error.message);
            }
        }

        function generateMockData(id) {
            const errorIdNum = parseInt(id) || 1;
            const subjects = [
                { name: '数学', en: 'math', question: '计算：125 × 8 = ?', userAnswer: '1024', correctAnswer: '1000' },
                { name: '语文', en: 'chinese', question: '下列词语中，没有错别字的是？', userAnswer: 'A', correctAnswer: 'C' },
                { name: '英语', en: 'english', question: 'I _____ to school every day.', userAnswer: 'goes', correctAnswer: 'go' }
            ];
            
            const difficulties = ['简单', '中等', '困难'];
            const subjectIndex = errorIdNum % 3;
            const difficultyIndex = errorIdNum % 3;
            
            const subject = subjects[subjectIndex];
            const difficulty = difficulties[difficultyIndex];
            
            // 检查复习状态
            const reviewedErrors = JSON.parse(localStorage.getItem('reviewedErrors') || '[]');
            const isReviewed = reviewedErrors.includes(id);
            
            return {
                id: id,
                subject: subject.name,
                subjectEn: subject.en,
                difficulty: difficulty,
                question: subject.question,
                userAnswer: subject.userAnswer,
                correctAnswer: subject.correctAnswer,
                explanation: '这是详细的解析内容，帮助理解题目的解题思路和方法。',
                isReviewed: isReviewed
            };
        }

        function displayErrorDetail(data) {
            console.log('开始显示错题详情:', data);
            
            try {
                // 隐藏加载状态
                document.getElementById('loadingSection').style.display = 'none';
                
                // 显示内容
                document.getElementById('errorContent').style.display = 'block';
                
                // 更新各个字段
                document.getElementById('subjectTitle').textContent = data.subject;
                document.getElementById('difficulty').textContent = data.difficulty;
                document.getElementById('reviewStatus').textContent = data.isReviewed ? '已复习' : '未复习';
                document.getElementById('questionText').textContent = data.question;
                document.getElementById('userAnswer').textContent = data.userAnswer;
                document.getElementById('correctAnswer').textContent = data.correctAnswer;
                document.getElementById('explanation').textContent = data.explanation;
                
                // 更新按钮状态
                const reviewBtn = document.getElementById('reviewBtn');
                if (data.isReviewed) {
                    reviewBtn.textContent = '✅ 已复习';
                    reviewBtn.disabled = true;
                    reviewBtn.style.background = '#6c757d';
                }
                
                // 保存数据
                errorData = data;
                
                console.log('错题详情显示完成');
                showStatus('页面加载成功', 'success');
                
            } catch (error) {
                console.error('显示错题详情失败:', error);
                showError('显示失败: ' + error.message);
            }
        }

        function markAsReviewed() {
            console.log('标记为已复习');
            
            try {
                // 更新本地存储
                const reviewedErrors = JSON.parse(localStorage.getItem('reviewedErrors') || '[]');
                if (!reviewedErrors.includes(errorId)) {
                    reviewedErrors.push(errorId);
                    localStorage.setItem('reviewedErrors', JSON.stringify(reviewedErrors));
                }
                
                // 更新数据和界面
                errorData.isReviewed = true;
                document.getElementById('reviewStatus').textContent = '已复习';
                
                const reviewBtn = document.getElementById('reviewBtn');
                reviewBtn.textContent = '✅ 已复习';
                reviewBtn.disabled = true;
                reviewBtn.style.background = '#6c757d';
                
                showStatus('已标记为已复习', 'success');
                
            } catch (error) {
                console.error('标记复习失败:', error);
                showError('标记失败: ' + error.message);
            }
        }

        function practiceSimilar() {
            console.log('练习相似题');
            const url = `similar-practice.html?errorId=${errorId}`;
            window.location.href = url;
        }

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('statusInfo');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
        }

        function showError(message) {
            console.error('错误:', message);
            showStatus(message, 'error');
            
            // 隐藏加载状态
            document.getElementById('loadingSection').style.display = 'none';
        }

        // 全局错误处理
        window.addEventListener('error', function(event) {
            console.error('全局错误:', event.error);
            showError('页面发生错误: ' + event.error.message);
        });
    </script>
</body>
</html>