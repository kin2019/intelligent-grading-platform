<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–ç‰ˆé”™é¢˜è¯¦æƒ…</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .content {
            padding: 20px;
        }
        .section {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007AFF;
        }
        .loading {
            text-align: center;
            padding: 40px;
        }
        .spinner {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056CC;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>é”™é¢˜è¯¦æƒ…</h2>
            <div id="errorId">ID: åŠ è½½ä¸­...</div>
        </div>
        
        <div class="content">
            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loadingSection" class="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨åŠ è½½é”™é¢˜è¯¦æƒ…...</p>
            </div>
            
            <!-- é”™é¢˜å†…å®¹ -->
            <div id="errorContent" style="display: none;">
                <div class="section">
                    <h3 id="subjectTitle">å­¦ç§‘</h3>
                    <p><strong>éš¾åº¦:</strong> <span id="difficulty">ä¸­ç­‰</span></p>
                    <p><strong>çŠ¶æ€:</strong> <span id="reviewStatus">æœªå¤ä¹ </span></p>
                </div>
                
                <div class="section">
                    <h3>é¢˜ç›®å†…å®¹</h3>
                    <p id="questionText">é¢˜ç›®å†…å®¹åŠ è½½ä¸­...</p>
                </div>
                
                <div class="section">
                    <h3>ç­”æ¡ˆå¯¹æ¯”</h3>
                    <p><strong>ä½ çš„ç­”æ¡ˆ:</strong> <span id="userAnswer">-</span></p>
                    <p><strong>æ­£ç¡®ç­”æ¡ˆ:</strong> <span id="correctAnswer">-</span></p>
                </div>
                
                <div class="section">
                    <h3>è¯¦ç»†è§£æ</h3>
                    <p id="explanation">è§£æå†…å®¹åŠ è½½ä¸­...</p>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn" id="reviewBtn" onclick="markAsReviewed()">âœ… æ ‡è®°å·²å¤ä¹ </button>
                    <button class="btn" onclick="practiceSimilar()">ğŸ“š ç»ƒä¹ ç›¸ä¼¼é¢˜</button>
                </div>
            </div>
            
            <div id="statusInfo"></div>
        </div>
    </div>

    <script>
        let errorId = '';
        let errorData = null;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢DOMåŠ è½½å®Œæˆ');
            initPage();
        });

        function initPage() {
            console.log('å¼€å§‹åˆå§‹åŒ–é¡µé¢');
            
            try {
                // è·å–é”™é¢˜ID
                const urlParams = new URLSearchParams(window.location.search);
                errorId = urlParams.get('id') || '1'; // é»˜è®¤ä¸º1
                
                console.log('è·å–åˆ°é”™é¢˜ID:', errorId);
                document.getElementById('errorId').textContent = `ID: ${errorId}`;
                
                // è®¾ç½®æµ‹è¯•token
                if (!localStorage.getItem('token')) {
                    localStorage.setItem('token', 'test_token');
                    console.log('è®¾ç½®æµ‹è¯•token');
                }
                
                // å»¶è¿ŸåŠ è½½ï¼Œæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
                setTimeout(() => {
                    loadErrorDetail();
                }, 1000);
                
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                showError('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        function loadErrorDetail() {
            console.log('å¼€å§‹åŠ è½½é”™é¢˜è¯¦æƒ…');
            
            try {
                // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
                const mockData = generateMockData(errorId);
                console.log('ç”Ÿæˆçš„æ¨¡æ‹Ÿæ•°æ®:', mockData);
                
                // æ˜¾ç¤ºæ•°æ®
                displayErrorDetail(mockData);
                
            } catch (error) {
                console.error('åŠ è½½é”™é¢˜è¯¦æƒ…å¤±è´¥:', error);
                showError('åŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        function generateMockData(id) {
            const errorIdNum = parseInt(id) || 1;
            const subjects = [
                { name: 'æ•°å­¦', en: 'math', question: 'è®¡ç®—ï¼š125 Ã— 8 = ?', userAnswer: '1024', correctAnswer: '1000' },
                { name: 'è¯­æ–‡', en: 'chinese', question: 'ä¸‹åˆ—è¯è¯­ä¸­ï¼Œæ²¡æœ‰é”™åˆ«å­—çš„æ˜¯ï¼Ÿ', userAnswer: 'A', correctAnswer: 'C' },
                { name: 'è‹±è¯­', en: 'english', question: 'I _____ to school every day.', userAnswer: 'goes', correctAnswer: 'go' }
            ];
            
            const difficulties = ['ç®€å•', 'ä¸­ç­‰', 'å›°éš¾'];
            const subjectIndex = errorIdNum % 3;
            const difficultyIndex = errorIdNum % 3;
            
            const subject = subjects[subjectIndex];
            const difficulty = difficulties[difficultyIndex];
            
            // æ£€æŸ¥å¤ä¹ çŠ¶æ€
            const reviewedErrors = JSON.parse(localStorage.getItem('reviewedErrors') || '[]');
            const isReviewed = reviewedErrors.includes(id);
            
            return {
                id: id,
                subject: subject.name,
                subjectEn: subject.en,
                difficulty: difficulty,
                question: subject.question,
                userAnswer: subject.userAnswer,
                correctAnswer: subject.correctAnswer,
                explanation: 'è¿™æ˜¯è¯¦ç»†çš„è§£æå†…å®¹ï¼Œå¸®åŠ©ç†è§£é¢˜ç›®çš„è§£é¢˜æ€è·¯å’Œæ–¹æ³•ã€‚',
                isReviewed: isReviewed
            };
        }

        function displayErrorDetail(data) {
            console.log('å¼€å§‹æ˜¾ç¤ºé”™é¢˜è¯¦æƒ…:', data);
            
            try {
                // éšè—åŠ è½½çŠ¶æ€
                document.getElementById('loadingSection').style.display = 'none';
                
                // æ˜¾ç¤ºå†…å®¹
                document.getElementById('errorContent').style.display = 'block';
                
                // æ›´æ–°å„ä¸ªå­—æ®µ
                document.getElementById('subjectTitle').textContent = data.subject;
                document.getElementById('difficulty').textContent = data.difficulty;
                document.getElementById('reviewStatus').textContent = data.isReviewed ? 'å·²å¤ä¹ ' : 'æœªå¤ä¹ ';
                document.getElementById('questionText').textContent = data.question;
                document.getElementById('userAnswer').textContent = data.userAnswer;
                document.getElementById('correctAnswer').textContent = data.correctAnswer;
                document.getElementById('explanation').textContent = data.explanation;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const reviewBtn = document.getElementById('reviewBtn');
                if (data.isReviewed) {
                    reviewBtn.textContent = 'âœ… å·²å¤ä¹ ';
                    reviewBtn.disabled = true;
                    reviewBtn.style.background = '#6c757d';
                }
                
                // ä¿å­˜æ•°æ®
                errorData = data;
                
                console.log('é”™é¢˜è¯¦æƒ…æ˜¾ç¤ºå®Œæˆ');
                showStatus('é¡µé¢åŠ è½½æˆåŠŸ', 'success');
                
            } catch (error) {
                console.error('æ˜¾ç¤ºé”™é¢˜è¯¦æƒ…å¤±è´¥:', error);
                showError('æ˜¾ç¤ºå¤±è´¥: ' + error.message);
            }
        }

        function markAsReviewed() {
            console.log('æ ‡è®°ä¸ºå·²å¤ä¹ ');
            
            try {
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                const reviewedErrors = JSON.parse(localStorage.getItem('reviewedErrors') || '[]');
                if (!reviewedErrors.includes(errorId)) {
                    reviewedErrors.push(errorId);
                    localStorage.setItem('reviewedErrors', JSON.stringify(reviewedErrors));
                }
                
                // æ›´æ–°æ•°æ®å’Œç•Œé¢
                errorData.isReviewed = true;
                document.getElementById('reviewStatus').textContent = 'å·²å¤ä¹ ';
                
                const reviewBtn = document.getElementById('reviewBtn');
                reviewBtn.textContent = 'âœ… å·²å¤ä¹ ';
                reviewBtn.disabled = true;
                reviewBtn.style.background = '#6c757d';
                
                showStatus('å·²æ ‡è®°ä¸ºå·²å¤ä¹ ', 'success');
                
            } catch (error) {
                console.error('æ ‡è®°å¤ä¹ å¤±è´¥:', error);
                showError('æ ‡è®°å¤±è´¥: ' + error.message);
            }
        }

        function practiceSimilar() {
            console.log('ç»ƒä¹ ç›¸ä¼¼é¢˜');
            const url = `similar-practice.html?errorId=${errorId}`;
            window.location.href = url;
        }

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('statusInfo');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
        }

        function showError(message) {
            console.error('é”™è¯¯:', message);
            showStatus(message, 'error');
            
            // éšè—åŠ è½½çŠ¶æ€
            document.getElementById('loadingSection').style.display = 'none';
        }

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(event) {
            console.error('å…¨å±€é”™è¯¯:', event.error);
            showError('é¡µé¢å‘ç”Ÿé”™è¯¯: ' + event.error.message);
        });
    </script>
</body>
</html>