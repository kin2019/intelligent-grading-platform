<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é”™é¢˜è¯¦æƒ…é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #0056CC;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status {
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h2>ğŸ” é”™é¢˜è¯¦æƒ…é¡µé¢è°ƒè¯•å·¥å…·</h2>
        
        <div class="debug-section">
            <h3>ç¯å¢ƒæ£€æŸ¥</h3>
            <div id="envStatus"></div>
            <button class="test-btn" onclick="checkEnvironment()">æ£€æŸ¥ç¯å¢ƒ</button>
        </div>
        
        <div class="debug-section">
            <h3>ç›´æ¥æµ‹è¯•æ¨¡æ‹Ÿæ•°æ®</h3>
            <button class="test-btn" onclick="testMockData(1)">æµ‹è¯•ID=1 (æ•°å­¦)</button>
            <button class="test-btn" onclick="testMockData(2)">æµ‹è¯•ID=2 (è¯­æ–‡)</button>
            <button class="test-btn" onclick="testMockData(3)">æµ‹è¯•ID=3 (è‹±è¯­)</button>
            <div id="mockResult"></div>
        </div>
        
        <div class="debug-section">
            <h3>æµ‹è¯•é¡µé¢è·³è½¬</h3>
            <button class="test-btn" onclick="openErrorDetail(1)">æ‰“å¼€é”™é¢˜1</button>
            <button class="test-btn" onclick="openErrorDetail(2)">æ‰“å¼€é”™é¢˜2</button>
            <button class="test-btn" onclick="openErrorDetail(3)">æ‰“å¼€é”™é¢˜3</button>
        </div>
        
        <div class="debug-section">
            <h3>æœ¬åœ°å­˜å‚¨ç®¡ç†</h3>
            <button class="test-btn" onclick="checkLocalStorage()">æ£€æŸ¥æœ¬åœ°å­˜å‚¨</button>
            <button class="test-btn" onclick="setTestToken()">è®¾ç½®æµ‹è¯•Token</button>
            <button class="test-btn" onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
            <div id="storageInfo"></div>
        </div>
        
        <div class="debug-section">
            <h3>è°ƒè¯•æ—¥å¿—</h3>
            <button class="test-btn" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
            <div id="debugLogs" class="log-area">ç­‰å¾…è°ƒè¯•ä¿¡æ¯...</div>
        </div>
    </div>

    <script>
        // é‡å†™console.logæ¥æ•è·æ—¥å¿—
        const originalLog = console.log;
        const originalError = console.error;
        const debugLogs = document.getElementById('debugLogs');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            debugLogs.textContent += logMessage;
            debugLogs.scrollTop = debugLogs.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('LOG: ' + args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('ERROR: ' + args.join(' '), 'error');
        };

        function checkEnvironment() {
            const envStatus = document.getElementById('envStatus');
            let status = '';
            
            // æ£€æŸ¥åŸºæœ¬ç¯å¢ƒ
            status += '<div class="status info">æµè§ˆå™¨: ' + navigator.userAgent.split(' ')[0] + '</div>';
            status += '<div class="status info">å½“å‰URL: ' + window.location.href + '</div>';
            
            // æ£€æŸ¥localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                status += '<div class="status success">localStorage: å¯ç”¨</div>';
            } catch (e) {
                status += '<div class="status error">localStorage: ä¸å¯ç”¨ - ' + e.message + '</div>';
            }
            
            // æ£€æŸ¥fetch API
            if (typeof fetch !== 'undefined') {
                status += '<div class="status success">Fetch API: å¯ç”¨</div>';
            } else {
                status += '<div class="status error">Fetch API: ä¸å¯ç”¨</div>';
            }
            
            envStatus.innerHTML = status;
        }

        function testMockData(errorId) {
            console.log('å¼€å§‹æµ‹è¯•æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆï¼Œé”™é¢˜ID:', errorId);
            
            try {
                // æ¨¡æ‹Ÿé”™é¢˜è¯¦æƒ…é¡µé¢çš„æ•°æ®ç”Ÿæˆé€»è¾‘
                const reviewedErrors = JSON.parse(localStorage.getItem('reviewedErrors') || '[]');
                const isReviewedLocal = reviewedErrors.includes(errorId.toString());
                
                const errorIdNum = parseInt(errorId) || 1;
                const subjectIndex = errorIdNum % 3;
                const subjects = ['math', 'chinese', 'english'];
                const difficulties = ['easy', 'medium', 'hard'];
                const baseSubject = subjects[subjectIndex];
                const baseDifficulty = difficulties[errorIdNum % 3];
                
                const mockData = {
                    id: errorId,
                    subject: baseSubject,
                    difficulty: baseDifficulty,
                    is_reviewed: isReviewedLocal,
                    created_at: new Date().toISOString(),
                    question_text: 'æµ‹è¯•é¢˜ç›®å†…å®¹',
                    user_answer: 'ç”¨æˆ·ç­”æ¡ˆ',
                    correct_answer: 'æ­£ç¡®ç­”æ¡ˆ',
                    explanation: 'è¯¦ç»†è§£æ'
                };
                
                console.log('ç”Ÿæˆçš„æ¨¡æ‹Ÿæ•°æ®:', mockData);
                
                const mockResult = document.getElementById('mockResult');
                mockResult.innerHTML = `
                    <div class="status success">
                        <strong>æ¨¡æ‹Ÿæ•°æ®ç”ŸæˆæˆåŠŸ:</strong><br>
                        ID: ${mockData.id}<br>
                        å­¦ç§‘: ${mockData.subject}<br>
                        éš¾åº¦: ${mockData.difficulty}<br>
                        å¤ä¹ çŠ¶æ€: ${mockData.is_reviewed ? 'å·²å¤ä¹ ' : 'æœªå¤ä¹ '}
                    </div>
                `;
                
            } catch (error) {
                console.error('æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå¤±è´¥:', error);
                document.getElementById('mockResult').innerHTML = 
                    '<div class="status error">æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå¤±è´¥: ' + error.message + '</div>';
            }
        }

        function openErrorDetail(errorId) {
            const url = `error-detail.html?id=${errorId}`;
            console.log('æ‰“å¼€é”™é¢˜è¯¦æƒ…é¡µé¢:', url);
            window.open(url, '_blank');
        }

        function checkLocalStorage() {
            const storageInfo = document.getElementById('storageInfo');
            const token = localStorage.getItem('token');
            const reviewedErrors = localStorage.getItem('reviewedErrors');
            
            let info = '<div class="status info"><strong>æœ¬åœ°å­˜å‚¨çŠ¶æ€:</strong></div>';
            info += `<div class="status ${token ? 'success' : 'error'}">Token: ${token || 'æœªè®¾ç½®'}</div>`;
            info += `<div class="status info">å·²å¤ä¹ é”™é¢˜: ${reviewedErrors || 'æ— '}</div>`;
            
            storageInfo.innerHTML = info;
        }

        function setTestToken() {
            localStorage.setItem('token', 'test_token_for_debug');
            console.log('å·²è®¾ç½®æµ‹è¯•Token');
            checkLocalStorage();
        }

        function clearAllData() {
            localStorage.clear();
            console.log('å·²æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®');
            checkLocalStorage();
        }

        function clearLogs() {
            debugLogs.textContent = 'æ—¥å¿—å·²æ¸…é™¤...\n';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('è°ƒè¯•é¡µé¢å·²åŠ è½½');
            checkEnvironment();
            checkLocalStorage();
        });
    </script>
</body>
</html>