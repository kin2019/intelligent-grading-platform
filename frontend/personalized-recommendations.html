<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªæ€§åŒ–é¢˜ç›®æ¨è - æ™ºèƒ½æ•™è‚²å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .recommendation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .recommendation-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .recommendation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
            color: white;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2d3748;
        }

        .weak-points-list {
            list-style: none;
            margin-bottom: 20px;
        }

        .weak-point-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .weak-point-item:last-child {
            border-bottom: none;
        }

        .weak-point-subject {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-right: 12px;
            min-width: 60px;
            text-align: center;
        }

        .weak-point-details {
            flex: 1;
        }

        .weak-point-title {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .weak-point-stats {
            font-size: 0.85rem;
            color: #666;
        }

        .error-rate {
            color: #d32f2f;
            font-weight: 600;
        }

        .progress-recommendations {
            margin-bottom: 25px;
        }

        .progress-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #4caf50;
        }

        .progress-icon {
            width: 40px;
            height: 40px;
            background: #4caf50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 18px;
        }

        .progress-content {
            flex: 1;
        }

        .progress-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .progress-description {
            font-size: 0.9rem;
            color: #666;
        }

        .difficulty-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .difficulty-easy {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .difficulty-medium {
            background: #fff3e0;
            color: #f57c00;
        }

        .difficulty-hard {
            background: #ffebee;
            color: #d32f2f;
        }

        .practice-suggestions {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .suggestion-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }

        .suggestion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .suggestion-card {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .suggestion-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .suggestion-card.recommended {
            border-color: #4caf50;
            background: linear-gradient(135deg, #f8fff8 0%, #f1f8f1 100%);
        }

        .suggestion-card.recommended::after {
            content: 'æ¨è';
            position: absolute;
            top: -1px;
            right: 12px;
            background: #4caf50;
            color: white;
            padding: 4px 12px;
            border-radius: 0 0 8px 8px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .suggestion-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .suggestion-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .suggestion-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .suggestion-count {
            font-size: 0.85rem;
            color: #667eea;
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .analytics-dashboard {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .analytics-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .analytics-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .analytics-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .analytics-trend {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .trend-up {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .trend-down {
            background: #ffebee;
            color: #d32f2f;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 8px;
        }

        .empty-hint {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }

        .empty-action {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .recommendation-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .recommendation-card, .practice-suggestions, .analytics-dashboard {
                padding: 20px;
            }

            .suggestion-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ ä¸ªæ€§åŒ–é¢˜ç›®æ¨è</h1>
            <p>åŸºäºæ‚¨çš„é”™é¢˜è®°å½•å’Œå­¦ä¹ è¿›åº¦ï¼ŒAIä¸ºæ‚¨é‡èº«å®šåˆ¶ç»ƒä¹ æ–¹æ¡ˆ</p>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading" id="loadingState">
            <div class="loading-spinner"></div>
            <div>æ­£åœ¨åˆ†ææ‚¨çš„å­¦ä¹ æ•°æ®...</div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div id="mainContent" style="display: none;">
            <!-- å­¦ä¹ åˆ†ææ¦‚è§ˆ -->
            <div class="analytics-dashboard">
                <div class="card-header">
                    <div class="card-icon">ğŸ“Š</div>
                    <div class="card-title">å­¦ä¹ åˆ†ææ¦‚è§ˆ</div>
                </div>
                <div class="analytics-grid" id="analyticsGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆåˆ†æå¡ç‰‡ -->
                </div>
            </div>

            <!-- è–„å¼±çŸ¥è¯†ç‚¹å’Œå­¦ä¹ è¿›åº¦ -->
            <div class="recommendation-grid">
                <!-- è–„å¼±çŸ¥è¯†ç‚¹åˆ†æ -->
                <div class="recommendation-card">
                    <div class="card-header">
                        <div class="card-icon">âš ï¸</div>
                        <div class="card-title">è–„å¼±çŸ¥è¯†ç‚¹åˆ†æ</div>
                    </div>
                    <ul class="weak-points-list" id="weakPointsList">
                        <!-- åŠ¨æ€ç”Ÿæˆè–„å¼±çŸ¥è¯†ç‚¹ -->
                    </ul>
                </div>

                <!-- å­¦ä¹ è¿›åº¦æ¨è -->
                <div class="recommendation-card">
                    <div class="card-header">
                        <div class="card-icon">ğŸ“ˆ</div>
                        <div class="card-title">å­¦ä¹ è¿›åº¦å»ºè®®</div>
                    </div>
                    <div class="progress-recommendations" id="progressRecommendations">
                        <!-- åŠ¨æ€ç”Ÿæˆè¿›åº¦å»ºè®® -->
                    </div>
                </div>
            </div>

            <!-- æ™ºèƒ½ç»ƒä¹ æ¨è -->
            <div class="practice-suggestions">
                <div class="suggestion-header">
                    <div class="card-icon">ğŸ’¡</div>
                    <div class="card-title">æ™ºèƒ½ç»ƒä¹ æ¨è</div>
                </div>
                <div class="suggestion-grid" id="practiceGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆç»ƒä¹ å»ºè®® -->
                </div>
            </div>
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">ğŸ“š</div>
            <div class="empty-text">æš‚æ— å­¦ä¹ æ•°æ®</div>
            <div class="empty-hint">å®Œæˆä¸€äº›ç»ƒä¹ å’Œé”™é¢˜è®°å½•åï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨ç”Ÿæˆä¸ªæ€§åŒ–æ¨è</div>
            <button class="empty-action" onclick="goToPractice()">å¼€å§‹ç»ƒä¹ </button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let token = localStorage.getItem('authToken') || localStorage.getItem('token');
        let userData = {};
        let errorData = [];
        let exerciseHistory = [];

        // å­¦ç§‘æ˜ å°„
        const subjectMapping = {
            'math': 'æ•°å­¦',
            'chinese': 'è¯­æ–‡', 
            'english': 'è‹±è¯­',
            'physics': 'ç‰©ç†',
            'chemistry': 'åŒ–å­¦',
            'biology': 'ç”Ÿç‰©'
        };

        // é”™è¯¯ç±»å‹æ˜ å°„
        const errorTypeMapping = {
            'è®¡ç®—é”™è¯¯': { icon: 'ğŸ”¢', color: '#ff6b6b' },
            'è¯­æ³•é”™è¯¯': { icon: 'ğŸ“', color: '#4ecdc4' },
            'çŸ¥è¯†é”™è¯¯': { icon: 'ğŸ’¡', color: '#45b7d1' },
            'è¿ç®—é”™è¯¯': { icon: 'ğŸ§®', color: '#96ceb4' },
            'åŸºç¡€æ¦‚å¿µ': { icon: 'ğŸ“', color: '#feca57' },
            'è¯æ±‡é”™è¯¯': { icon: 'ğŸ“–', color: '#ff9ff3' },
            'ç¿»è¯‘é”™è¯¯': { icon: 'ğŸŒ', color: '#54a0ff' }
        };

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initPage();
        });

        async function initPage() {
            if (!token) {
                showError('è¯·å…ˆç™»å½•');
                setTimeout(() => {
                    window.location.href = '/frontend/login.html';
                }, 2000);
                return;
            }

            try {
                await loadUserData();
                await loadErrorData();
                await loadExerciseHistory();
                
                if (errorData.length === 0 && exerciseHistory.length === 0) {
                    showEmptyState();
                } else {
                    generateRecommendations();
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                showError('æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            } finally {
                hideLoading();
            }
        }

        // åŠ è½½ç”¨æˆ·æ•°æ®
        async function loadUserData() {
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    userData = await response.json();
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½é”™é¢˜æ•°æ®
        async function loadErrorData() {
            try {
                const response = await fetch(`${API_BASE}/student/error-book`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    const data = await response.json();
                    errorData = data.recent_errors || [];
                }
            } catch (error) {
                console.error('åŠ è½½é”™é¢˜æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½ç»ƒä¹ å†å²
        async function loadExerciseHistory() {
            try {
                const response = await fetch(`${API_BASE}/exercise/history`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    const data = await response.json();
                    exerciseHistory = data.exercises || [];
                }
            } catch (error) {
                console.error('åŠ è½½ç»ƒä¹ å†å²å¤±è´¥:', error);
            }
        }

        // ç”Ÿæˆä¸ªæ€§åŒ–æ¨è
        function generateRecommendations() {
            const analysis = analyzeUserData();
            
            renderAnalyticsDashboard(analysis);
            renderWeakPoints(analysis.weakPoints);
            renderProgressRecommendations(analysis.progressLevel);
            renderPracticeRecommendations(analysis);
            
            showMainContent();
        }

        // åˆ†æç”¨æˆ·æ•°æ®
        function analyzeUserData() {
            const analysis = {
                totalErrors: errorData.length,
                totalExercises: exerciseHistory.length,
                weakPoints: [],
                subjectStats: {},
                errorTypeStats: {},
                progressLevel: 'beginner',
                recentActivity: [],
                recommendedDifficulty: 'medium',
                focusAreas: []
            };

            // åˆ†æé”™é¢˜æ•°æ®
            if (errorData.length > 0) {
                // æŒ‰å­¦ç§‘ç»Ÿè®¡é”™è¯¯
                errorData.forEach(error => {
                    const subject = getSubjectDisplayName(error.subject);
                    if (!analysis.subjectStats[subject]) {
                        analysis.subjectStats[subject] = {
                            total: 0,
                            reviewed: 0,
                            unreviewed: 0,
                            errorTypes: {}
                        };
                    }
                    
                    analysis.subjectStats[subject].total++;
                    if (error.is_reviewed) {
                        analysis.subjectStats[subject].reviewed++;
                    } else {
                        analysis.subjectStats[subject].unreviewed++;
                    }

                    // ç»Ÿè®¡é”™è¯¯ç±»å‹
                    const errorType = error.error_type || 'æœªåˆ†ç±»';
                    if (!analysis.subjectStats[subject].errorTypes[errorType]) {
                        analysis.subjectStats[subject].errorTypes[errorType] = 0;
                    }
                    analysis.subjectStats[subject].errorTypes[errorType]++;
                    
                    if (!analysis.errorTypeStats[errorType]) {
                        analysis.errorTypeStats[errorType] = 0;
                    }
                    analysis.errorTypeStats[errorType]++;
                });

                // è¯†åˆ«è–„å¼±çŸ¥è¯†ç‚¹
                analysis.weakPoints = identifyWeakPoints(analysis.subjectStats);
            }

            // åˆ†æç»ƒä¹ å†å²
            if (exerciseHistory.length > 0) {
                analysis.progressLevel = determineProgressLevel(exerciseHistory);
                analysis.recommendedDifficulty = getRecommendedDifficulty(analysis);
            }

            // ç”Ÿæˆé‡ç‚¹å…³æ³¨é¢†åŸŸ
            analysis.focusAreas = generateFocusAreas(analysis);

            return analysis;
        }

        // è¯†åˆ«è–„å¼±çŸ¥è¯†ç‚¹
        function identifyWeakPoints(subjectStats) {
            const weakPoints = [];
            
            Object.entries(subjectStats).forEach(([subject, stats]) => {
                if (stats.total >= 2) { // è‡³å°‘æœ‰2ä¸ªé”™è¯¯æ‰è®¤ä¸ºæ˜¯è–„å¼±ç‚¹
                    const errorRate = (stats.unreviewed / stats.total * 100).toFixed(1);
                    const mainErrorTypes = Object.entries(stats.errorTypes)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 2)
                        .map(([type, count]) => ({ type, count }));

                    weakPoints.push({
                        subject,
                        totalErrors: stats.total,
                        unreviewedErrors: stats.unreviewed,
                        errorRate: parseFloat(errorRate),
                        mainErrorTypes,
                        priority: stats.unreviewed > 5 ? 'high' : stats.unreviewed > 2 ? 'medium' : 'low'
                    });
                }
            });

            return weakPoints.sort((a, b) => b.errorRate - a.errorRate);
        }

        // ç¡®å®šå­¦ä¹ è¿›åº¦æ°´å¹³
        function determineProgressLevel(history) {
            if (history.length < 5) return 'beginner';
            if (history.length < 15) return 'intermediate';
            return 'advanced';
        }

        // è·å–æ¨èéš¾åº¦
        function getRecommendedDifficulty(analysis) {
            const avgErrorRate = analysis.weakPoints.length > 0 
                ? analysis.weakPoints.reduce((sum, wp) => sum + wp.errorRate, 0) / analysis.weakPoints.length 
                : 0;

            if (avgErrorRate > 70) return 'easy';
            if (avgErrorRate > 40) return 'medium';
            return 'hard';
        }

        // ç”Ÿæˆé‡ç‚¹å…³æ³¨é¢†åŸŸ
        function generateFocusAreas(analysis) {
            const areas = [];
            
            // åŸºäºé”™è¯¯ç±»å‹æ¨è
            Object.entries(analysis.errorTypeStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3)
                .forEach(([errorType, count]) => {
                    if (count >= 2) {
                        areas.push({
                            type: 'error-type',
                            name: errorType,
                            count,
                            priority: count > 5 ? 'high' : count > 2 ? 'medium' : 'low'
                        });
                    }
                });

            // åŸºäºå­¦ç§‘æ¨è
            analysis.weakPoints.slice(0, 2).forEach(wp => {
                areas.push({
                    type: 'subject',
                    name: wp.subject,
                    count: wp.unreviewedErrors,
                    priority: wp.priority
                });
            });

            return areas;
        }

        // æ¸²æŸ“åˆ†ææ¦‚è§ˆ
        function renderAnalyticsDashboard(analysis) {
            const grid = document.getElementById('analyticsGrid');
            
            const cards = [
                {
                    value: analysis.totalErrors,
                    label: 'æ€»é”™é¢˜æ•°é‡',
                    trend: analysis.totalErrors > 10 ? 'down' : 'up',
                    trendText: analysis.totalErrors > 10 ? 'éœ€è¦å…³æ³¨' : 'è¡¨ç°è‰¯å¥½'
                },
                {
                    value: analysis.totalExercises,
                    label: 'å®Œæˆç»ƒä¹ ',
                    trend: 'up',
                    trendText: 'æŒç»­è¿›æ­¥'
                },
                {
                    value: analysis.weakPoints.length,
                    label: 'è–„å¼±çŸ¥è¯†ç‚¹',
                    trend: analysis.weakPoints.length > 3 ? 'down' : 'up',
                    trendText: analysis.weakPoints.length > 3 ? 'éœ€è¦åŠ å¼º' : 'æŒæ¡è‰¯å¥½'
                },
                {
                    value: Object.keys(analysis.subjectStats).length,
                    label: 'æ¶‰åŠå­¦ç§‘',
                    trend: 'up',
                    trendText: 'å…¨é¢å‘å±•'
                }
            ];

            grid.innerHTML = cards.map(card => `
                <div class="analytics-card">
                    <div class="analytics-value">${card.value}</div>
                    <div class="analytics-label">${card.label}</div>
                    <div class="analytics-trend trend-${card.trend}">${card.trendText}</div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“è–„å¼±çŸ¥è¯†ç‚¹
        function renderWeakPoints(weakPoints) {
            const list = document.getElementById('weakPointsList');
            
            if (weakPoints.length === 0) {
                list.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #4caf50;">
                        ğŸ‰ æš‚æ— æ˜æ˜¾è–„å¼±çŸ¥è¯†ç‚¹ï¼Œç»§ç»­ä¿æŒï¼
                    </div>
                `;
                return;
            }

            list.innerHTML = weakPoints.slice(0, 5).map(wp => `
                <li class="weak-point-item">
                    <div class="weak-point-subject">${wp.subject}</div>
                    <div class="weak-point-details">
                        <div class="weak-point-title">
                            ${wp.mainErrorTypes[0]?.type || 'ç»¼åˆé”™è¯¯'} 
                            <span class="difficulty-badge difficulty-${wp.priority === 'high' ? 'hard' : wp.priority === 'medium' ? 'medium' : 'easy'}">
                                ${wp.priority === 'high' ? 'æ€¥éœ€æ”¹è¿›' : wp.priority === 'medium' ? 'éœ€è¦å…³æ³¨' : 'è½»å¾®è–„å¼±'}
                            </span>
                        </div>
                        <div class="weak-point-stats">
                            é”™è¯¯ç‡ <span class="error-rate">${wp.errorRate}%</span> | 
                            ${wp.unreviewedErrors} é“æœªå¤ä¹  | 
                            ${wp.totalErrors} é“é”™é¢˜
                        </div>
                    </div>
                </li>
            `).join('');
        }

        // æ¸²æŸ“å­¦ä¹ è¿›åº¦å»ºè®®
        function renderProgressRecommendations(progressLevel) {
            const container = document.getElementById('progressRecommendations');
            
            const recommendations = {
                'beginner': [
                    {
                        icon: 'ğŸŒ±',
                        title: 'åŸºç¡€å·©å›ºé˜¶æ®µ',
                        description: 'ä¸“æ³¨äºåŸºç¡€æ¦‚å¿µçš„ç†è§£å’Œè®°å¿†ï¼Œå»ºè®®æ¯å¤©ç»ƒä¹ 15-30åˆ†é’Ÿ'
                    },
                    {
                        icon: 'ğŸ“š',
                        title: 'å¾ªåºæ¸è¿›å­¦ä¹ ',
                        description: 'ä»ç®€å•é¢˜ç›®å¼€å§‹ï¼Œé€æ­¥æå‡éš¾åº¦ï¼Œä¸è¦æ€¥äºæ±‚æˆ'
                    }
                ],
                'intermediate': [
                    {
                        icon: 'âš¡',
                        title: 'æŠ€èƒ½æå‡é˜¶æ®µ',
                        description: 'å¯ä»¥å°è¯•ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼ŒåŠ å¼ºè§£é¢˜æŠ€å·§çš„è®­ç»ƒ'
                    },
                    {
                        icon: 'ğŸ¯',
                        title: 'ä¸“é¡¹çªç ´',
                        description: 'é’ˆå¯¹è–„å¼±ç¯èŠ‚è¿›è¡Œä¸“é¡¹ç»ƒä¹ ï¼Œæé«˜è§£é¢˜å‡†ç¡®ç‡'
                    }
                ],
                'advanced': [
                    {
                        icon: 'ğŸš€',
                        title: 'æŒ‘æˆ˜æå‡é˜¶æ®µ',
                        description: 'å¯ä»¥æŒ‘æˆ˜é«˜éš¾åº¦é¢˜ç›®ï¼ŒåŸ¹å…»ç»¼åˆåˆ†æèƒ½åŠ›'
                    },
                    {
                        icon: 'ğŸ§ ',
                        title: 'åˆ›æ–°æ€ç»´',
                        description: 'å°è¯•ä¸€é¢˜å¤šè§£ï¼ŒåŸ¹å…»å‘æ•£æ€ç»´å’Œåˆ›æ–°èƒ½åŠ›'
                    }
                ]
            };

            const items = recommendations[progressLevel] || recommendations['beginner'];
            
            container.innerHTML = items.map(item => `
                <div class="progress-item">
                    <div class="progress-icon">${item.icon}</div>
                    <div class="progress-content">
                        <div class="progress-title">${item.title}</div>
                        <div class="progress-description">${item.description}</div>
                    </div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“ç»ƒä¹ æ¨è
        function renderPracticeRecommendations(analysis) {
            const grid = document.getElementById('practiceGrid');
            
            const recommendations = generatePracticeRecommendations(analysis);
            
            grid.innerHTML = recommendations.map((rec, index) => `
                <div class="suggestion-card ${index === 0 ? 'recommended' : ''}" onclick="selectRecommendation(${index})">
                    <div class="suggestion-title">${rec.title}</div>
                    <div class="suggestion-description">${rec.description}</div>
                    <div class="suggestion-stats">
                        <span class="suggestion-count">${rec.questionCount} é“é¢˜ç›®</span>
                        <span class="difficulty-badge difficulty-${rec.difficulty}">
                            ${rec.difficulty === 'easy' ? 'ç®€å•' : rec.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å›°éš¾'}
                        </span>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="startPractice(${index}); event.stopPropagation();">
                            ğŸš€ å¼€å§‹ç»ƒä¹ 
                        </button>
                        <button class="btn btn-secondary" onclick="viewDetails(${index}); event.stopPropagation();">
                            ğŸ“‹ æŸ¥çœ‹è¯¦æƒ…
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ç”Ÿæˆç»ƒä¹ æ¨è
        function generatePracticeRecommendations(analysis) {
            const recommendations = [];
            
            // åŸºäºè–„å¼±çŸ¥è¯†ç‚¹çš„æ¨è
            if (analysis.weakPoints.length > 0) {
                const topWeakPoint = analysis.weakPoints[0];
                recommendations.push({
                    title: `${topWeakPoint.subject}ä¸“é¡¹å¼ºåŒ–`,
                    description: `é’ˆå¯¹æ‚¨åœ¨${topWeakPoint.subject}ä¸­çš„è–„å¼±ç¯èŠ‚è¿›è¡Œä¸“é¡¹ç»ƒä¹ ï¼Œé‡ç‚¹è§£å†³${topWeakPoint.mainErrorTypes[0]?.type || 'å¸¸è§é—®é¢˜'}`,
                    questionCount: 10,
                    difficulty: analysis.recommendedDifficulty,
                    subject: topWeakPoint.subject,
                    type: 'weakness-focus',
                    config: {
                        subject: Object.keys(subjectMapping).find(key => subjectMapping[key] === topWeakPoint.subject) || 'math',
                        difficulty_level: analysis.recommendedDifficulty,
                        question_count: 10,
                        focus_area: topWeakPoint.mainErrorTypes[0]?.type
                    }
                });
            }

            // ç»¼åˆå¤ä¹ æ¨è
            if (Object.keys(analysis.subjectStats).length > 1) {
                recommendations.push({
                    title: 'ç»¼åˆçŸ¥è¯†å¤ä¹ ',
                    description: 'æ¶µç›–å¤šä¸ªå­¦ç§‘çš„ç»¼åˆç»ƒä¹ ï¼Œå¸®åŠ©æ‚¨å·©å›ºå„ç§‘çŸ¥è¯†ç‚¹',
                    questionCount: 15,
                    difficulty: 'medium',
                    type: 'comprehensive-review',
                    config: {
                        question_count: 15,
                        difficulty_level: 'medium',
                        mixed_subjects: true
                    }
                });
            }

            // é”™è¯¯ç±»å‹ä¸“é¡¹
            const topErrorType = Object.entries(analysis.errorTypeStats)
                .sort((a, b) => b[1] - a[1])[0];
            
            if (topErrorType && topErrorType[1] >= 3) {
                recommendations.push({
                    title: `${topErrorType[0]}ä¸“é¡¹è®­ç»ƒ`,
                    description: `ä¸“é—¨é’ˆå¯¹${topErrorType[0]}è¿›è¡Œå¼ºåŒ–è®­ç»ƒï¼Œæé«˜æ­¤ç±»é¢˜ç›®çš„è§£é¢˜å‡†ç¡®ç‡`,
                    questionCount: 12,
                    difficulty: analysis.recommendedDifficulty,
                    type: 'error-type-focus',
                    config: {
                        error_type: topErrorType[0],
                        question_count: 12,
                        difficulty_level: analysis.recommendedDifficulty
                    }
                });
            }

            // æ¯æ—¥åŸºç¡€ç»ƒä¹ 
            recommendations.push({
                title: 'æ¯æ—¥åŸºç¡€ç»ƒä¹ ',
                description: 'é€‚åˆæ—¥å¸¸ç»ƒä¹ çš„åŸºç¡€é¢˜ç›®ï¼Œä¿æŒå­¦ä¹ çŠ¶æ€å’Œæ‰‹æ„Ÿ',
                questionCount: 8,
                difficulty: 'easy',
                type: 'daily-practice',
                config: {
                    question_count: 8,
                    difficulty_level: 'easy',
                    mixed_subjects: true
                }
            });

            return recommendations.slice(0, 4);
        }

        // é€‰æ‹©æ¨è
        function selectRecommendation(index) {
            document.querySelectorAll('.suggestion-card').forEach((card, i) => {
                card.classList.toggle('recommended', i === index);
            });
        }

        // å¼€å§‹ç»ƒä¹ 
        function startPractice(index) {
            const recommendations = generatePracticeRecommendations(analyzeUserData());
            const recommendation = recommendations[index];
            
            // å­˜å‚¨æ¨èé…ç½®
            sessionStorage.setItem('recommendedConfig', JSON.stringify(recommendation.config));
            sessionStorage.setItem('recommendationType', recommendation.type);
            sessionStorage.setItem('recommendationTitle', recommendation.title);
            
            // è·³è½¬åˆ°ç»ƒä¹ é…ç½®é¡µé¢
            window.location.href = '/frontend/exercise-config.html?from=recommendation';
        }

        // æŸ¥çœ‹è¯¦æƒ…
        function viewDetails(index) {
            const recommendations = generatePracticeRecommendations(analyzeUserData());
            const recommendation = recommendations[index];
            
            alert(`ç»ƒä¹ è¯¦æƒ…ï¼š\n\næ ‡é¢˜ï¼š${recommendation.title}\næè¿°ï¼š${recommendation.description}\né¢˜ç›®æ•°é‡ï¼š${recommendation.questionCount}\néš¾åº¦ï¼š${recommendation.difficulty}\nç±»å‹ï¼š${recommendation.type}`);
        }

        // è·å–å­¦ç§‘æ˜¾ç¤ºåç§°
        function getSubjectDisplayName(rawSubject) {
            if (!rawSubject) return 'æœªçŸ¥å­¦ç§‘';
            
            if (['æ•°å­¦', 'è¯­æ–‡', 'è‹±è¯­', 'ç‰©ç†', 'åŒ–å­¦', 'ç”Ÿç‰©'].includes(rawSubject)) {
                return rawSubject;
            }
            
            return subjectMapping[rawSubject] || rawSubject;
        }

        // æ˜¾ç¤ºä¸»è¦å†…å®¹
        function showMainContent() {
            document.getElementById('mainContent').style.display = 'block';
        }

        // æ˜¾ç¤ºç©ºçŠ¶æ€
        function showEmptyState() {
            document.getElementById('emptyState').style.display = 'block';
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            document.getElementById('loadingState').style.display = 'none';
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            hideLoading();
            alert('é”™è¯¯ï¼š' + message);
        }

        // å»ç»ƒä¹ 
        function goToPractice() {
            window.location.href = '/frontend/exercise-config.html';
        }
    </script>
</body>
</html>