<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name=\"viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€æ˜“PDFç”Ÿæˆå™¨æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        
        .test-area { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            margin-bottom: 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-btn { 
            padding: 12px 24px; 
            margin: 8px; 
            background: #28a745; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px;
        }
        
        .test-btn:hover {
            background: #218838;
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        #result { 
            margin-top: 20px; 
            padding: 16px; 
            background: #f8f9fa; 
            border-radius: 8px; 
            font-size: 14px;
            line-height: 1.5;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .sample-questions {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .question-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="test-area">
        <h2>ğŸ“‹ ç®€æ˜“PDFç”Ÿæˆå™¨æµ‹è¯•</h2>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•SimplePDFGeneratorï¼Œç°åœ¨æ”¯æŒç›´æ¥ä¸‹è½½PDFæ–‡ä»¶ï¼Œå®Œç¾æ”¯æŒä¸­æ–‡å†…å®¹</p>
        <p><strong>åŠŸèƒ½ï¼š</strong>ç‚¹å‡»æµ‹è¯•æŒ‰é’®åä¼šç›´æ¥ç”Ÿæˆå¹¶ä¸‹è½½PDFæ–‡ä»¶åˆ°æœ¬åœ°ï¼Œæ— éœ€æ‰“å¼€æ–°çª—å£</p>
        
        <div>
            <button class="test-btn" onclick="testDirectDownloadPDF()" id="directDownloadBtn">â¬‡ï¸ æµ‹è¯•ç›´æ¥ä¸‹è½½PDF</button>
            <button class="test-btn" onclick="testSimplePDF()" id="testBtn">ğŸ” æµ‹è¯•ç®€æ˜“PDFç”Ÿæˆ</button>
            <button class="test-btn" onclick="testHTMLToPDF()" id="htmlToPdfBtn">ğŸŒ æµ‹è¯•HTMLè½¬PDFï¼ˆå¤‡ç”¨ï¼‰</button>
            <button class="test-btn" onclick="testWithConsoleDebug()" id="debugBtn">ğŸ› è°ƒè¯•æ¨¡å¼æµ‹è¯•</button>
            <button class="test-btn" onclick="clearResult()">ğŸ§¹ æ¸…ç©ºç»“æœ</button>
        </div>
        
        <div class="sample-questions">
            <h4>æµ‹è¯•æ•°æ®é¢„è§ˆï¼š</h4>
            <div class="question-item">
                <strong>é¢˜ç›®1ï¼š</strong>è®¡ç®—ï¼š125 Ã— 8 = ?<br>
                <strong>ç­”æ¡ˆï¼š</strong>1000<br>
                <strong>è§£æï¼š</strong>è¿™æ˜¯ä¸€é“åŸºæœ¬çš„ä¹˜æ³•è¿ç®—é¢˜ç›®ï¼Œéœ€è¦æ³¨æ„è¿›ä½å¤„ç†
            </div>
            <div class="question-item">
                <strong>é¢˜ç›®2ï¼š</strong>ä¸‹åˆ—è¯è¯­ä¸­ï¼Œæ²¡æœ‰é”™åˆ«å­—çš„ä¸€ç»„æ˜¯ï¼ˆï¼‰<br>
                <strong>ç­”æ¡ˆï¼š</strong>B<br>
                <strong>è§£æï¼š</strong>æ³¨æ„åŒºåˆ†å½¢è¿‘å­—å’ŒéŸ³è¿‘å­—çš„å†™æ³•å·®å¼‚
            </div>
            <div class="question-item">
                <strong>é¢˜ç›®3ï¼š</strong>Choose the correct answer: I ____ to school every day.<br>
                <strong>ç­”æ¡ˆï¼š</strong>go<br>
                <strong>è§£æï¼š</strong>ä¸€èˆ¬ç°åœ¨æ—¶ï¼Œç¬¬ä¸€äººç§°å•æ•°ç”¨åŠ¨è¯åŸå½¢
            </div>
        </div>
        
        <div id="result">
            ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•ç®€æ˜“PDFç”ŸæˆåŠŸèƒ½...
        </div>
    </div>
    
    <div class="test-area">
        <h3>ğŸ”— å¯¼èˆª</h3>
        <a href="error-book.html" class="test-btn" style="text-decoration: none;">è¿”å›é”™é¢˜æœ¬é¡µé¢</a>
        <a href="pdf-test.html" class="test-btn" style="text-decoration: none;">å®Œæ•´PDFæµ‹è¯•é¡µé¢</a>
    </div>

    <script src="simple-pdf-generator.js"></script>
    <script>
        function updateResult(content) {
            const result = document.getElementById('result');
            result.textContent = content;
        }

        function clearResult() {
            updateResult('ç»“æœå·²æ¸…ç©ºï¼Œå¯ä»¥é‡æ–°å¼€å§‹æµ‹è¯•...');
        }

        async function testSimplePDF(options = {}) {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'ç”Ÿæˆä¸­...';
            
            const optionText = options.translateChinese ? 
                (options.showBothLanguages ? 'ä¸­è‹±å¯¹ç…§æ¨¡å¼' : 'çº¯è‹±æ–‡æ¨¡å¼') : 
                'é»˜è®¤æ¨¡å¼';
            
            updateResult(`å¼€å§‹æµ‹è¯•ç®€æ˜“PDFç”Ÿæˆ - ${optionText}...\n`);
            
            try {
                // æ£€æŸ¥SimplePDFGeneratoræ˜¯å¦åŠ è½½
                if (typeof SimplePDFGenerator === 'undefined') {
                    throw new Error('SimplePDFGeneratoræœªåŠ è½½');
                }
                
                updateResult(`SimplePDFGeneratorå·²åŠ è½½\næ­£åœ¨åˆ›å»ºæµ‹è¯•æ•°æ®...\né€‰é¡¹: ${JSON.stringify(options, null, 2)}\n`);
                
                // ä½¿ç”¨æµ‹è¯•æ•°æ®
                const testQuestions = SimplePDFGenerator.createTestQuestions();
                updateResult(`æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆï¼Œå…±${testQuestions.length}é“é¢˜ç›®\næ­£åœ¨ç”ŸæˆPDF...\n`);
                
                // åˆ›å»ºç”Ÿæˆå™¨å®ä¾‹
                const generator = new SimplePDFGenerator();
                
                // ç”ŸæˆPDFï¼ˆä¼ å…¥é€‰é¡¹ï¼‰
                const success = await generator.generatePDF(testQuestions, options);
                
                if (success) {
                    updateResult(`âœ… ${optionText}PDFæ–‡ä»¶å·²ç”Ÿæˆå¹¶å¼€å§‹ä¸‹è½½ï¼\nç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleTimeString()}\n\næ–‡ä»¶åæ ¼å¼ï¼šç»ƒä¹ é¢˜é›†-YYYYMMDD.pdf\nå†…å®¹ä¸ç›¸ä¼¼ç»ƒä¹ é¡µé¢å®Œå…¨ä¸€è‡´ï¼Œæ”¯æŒå®Œæ•´ä¸­æ–‡æ˜¾ç¤ºï¼\n\nè¯·æ£€æŸ¥æµè§ˆå™¨ä¸‹è½½æ–‡ä»¶å¤¹æŸ¥çœ‹PDFæ–‡ä»¶ã€‚`);
                } else {
                    throw new Error('PDFç”Ÿæˆè¿”å›å¤±è´¥çŠ¶æ€');
                }
                
            } catch (error) {
                updateResult(`âŒ ${optionText}PDFç”Ÿæˆå¤±è´¥\né”™è¯¯ä¿¡æ¯ï¼š${error.message}\né”™è¯¯å †æ ˆï¼š\n${error.stack || 'æ— å †æ ˆä¿¡æ¯'}`);
                console.error('æµ‹è¯•å¤±è´¥:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        async function testWithConsoleDebug() {
            const btn = document.getElementById('debugBtn');
            btn.disabled = true;
            btn.textContent = 'è°ƒè¯•ä¸­...';
            
            updateResult('å¼€å§‹è°ƒè¯•æ¨¡å¼æµ‹è¯•...\nè¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—\n\n');
            
            try {
                console.clear();
                console.log('=== ç®€æ˜“PDFç”Ÿæˆå™¨è°ƒè¯•æµ‹è¯•å¼€å§‹ ===');
                
                // æ£€æŸ¥ç¯å¢ƒ
                console.log('æ£€æŸ¥SimplePDFGenerator:', typeof SimplePDFGenerator);
                console.log('æ£€æŸ¥Canvasæ”¯æŒ:', !!document.createElement('canvas').getContext);
                console.log('æ£€æŸ¥Blobæ”¯æŒ:', typeof Blob !== 'undefined');
                console.log('æ£€æŸ¥URL.createObjectURLæ”¯æŒ:', typeof URL !== 'undefined' && typeof URL.createObjectURL === 'function');
                
                const testQuestions = [
                    {
                        number: 1,
                        difficulty: 'same',
                        content: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é¢˜ç›®ï¼š2 + 2 = ?',
                        answer: '4',
                        analysis: 'ç®€å•çš„åŠ æ³•è¿ç®—'
                    }
                ];
                
                console.log('æµ‹è¯•é¢˜ç›®æ•°æ®:', testQuestions);
                
                const generator = new SimplePDFGenerator();
                console.log('SimplePDFGeneratorå®ä¾‹åˆ›å»ºå®Œæˆ');
                
                // æµ‹è¯•å†…å®¹ç”Ÿæˆ
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.font = '12px Arial';
                
                const pageContent = generator.generatePageContent(testQuestions, ctx);
                console.log('é¡µé¢å†…å®¹ç”Ÿæˆå®Œæˆï¼Œé•¿åº¦:', pageContent.length);
                console.log('é¡µé¢å†…å®¹é¢„è§ˆ:', pageContent.substring(0, 500));
                
                const pdfContent = generator.buildPDFContent(testQuestions, ctx);
                console.log('PDFå†…å®¹æ„å»ºå®Œæˆï¼Œæ€»é•¿åº¦:', pdfContent.length);
                
                // ç”Ÿæˆå®Œæ•´PDF
                const success = await generator.generatePDF(testQuestions);
                
                updateResult(`è°ƒè¯•æµ‹è¯•å®Œæˆ\nç»“æœï¼š${success ? 'æˆåŠŸ' : 'å¤±è´¥'}\n\nè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°\nç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleTimeString()}`);
                
                console.log('=== ç®€æ˜“PDFç”Ÿæˆå™¨è°ƒè¯•æµ‹è¯•ç»“æŸ ===');
                
            } catch (error) {
                updateResult(`è°ƒè¯•æµ‹è¯•å¤±è´¥\né”™è¯¯ï¼š${error.message}\nè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹æ§åˆ¶å°`);
                console.error('è°ƒè¯•æµ‹è¯•å¤±è´¥:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ› è°ƒè¯•æ¨¡å¼æµ‹è¯•';
            }
        }
        
        async function testDirectDownloadPDF() {
            const btn = document.getElementById('directDownloadBtn');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'ä¸‹è½½ä¸­...';
            
            updateResult('å¼€å§‹æµ‹è¯•ç›´æ¥ä¸‹è½½PDFåŠŸèƒ½...\n');
            
            try {
                // æ£€æŸ¥SimplePDFGeneratoræ˜¯å¦åŠ è½½
                if (typeof SimplePDFGenerator === 'undefined') {
                    throw new Error('SimplePDFGeneratoræœªåŠ è½½');
                }
                
                updateResult('SimplePDFGeneratorå·²åŠ è½½\næ­£åœ¨åˆ›å»ºæµ‹è¯•æ•°æ®...\n');
                
                // ä½¿ç”¨æµ‹è¯•æ•°æ®
                const testQuestions = SimplePDFGenerator.createTestQuestions();
                updateResult(`æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆï¼Œå…±${testQuestions.length}é“é¢˜ç›®\næ­£åœ¨ç”ŸæˆPDFå¹¶ä¸‹è½½...\n`);
                
                // åˆ›å»ºç”Ÿæˆå™¨å®ä¾‹å¹¶ç›´æ¥ä¸‹è½½
                const generator = new SimplePDFGenerator();
                const success = await generator.generateDirectPDF(testQuestions);
                
                if (success) {
                    updateResult(`âœ… PDFæ–‡ä»¶ç›´æ¥ä¸‹è½½æˆåŠŸï¼\nç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleTimeString()}\n\næ–‡ä»¶å·²ä¿å­˜åˆ°æµè§ˆå™¨ä¸‹è½½æ–‡ä»¶å¤¹\næ–‡ä»¶åï¼šç»ƒä¹ é¢˜é›†-YYYYMMDD.pdf\n\nåŒ…å«å®Œæ•´çš„ä¸­æ–‡å†…å®¹ï¼Œæ ¼å¼ä¸ç›¸ä¼¼ç»ƒä¹ é¡µé¢å®Œå…¨ä¸€è‡´ï¼`);
                } else {
                    throw new Error('PDFç›´æ¥ä¸‹è½½å¤±è´¥');
                }
                
            } catch (error) {
                updateResult(`âŒ PDFç›´æ¥ä¸‹è½½æµ‹è¯•å¤±è´¥\né”™è¯¯ä¿¡æ¯ï¼š${error.message}\n\nå¯èƒ½åŸå› ï¼š\n1. Canvasä¸æ”¯æŒ\n2. Blob APIä¸å¯ç”¨\n3. å›¾ç‰‡è½¬æ¢å¤±è´¥\n\nå»ºè®®ä½¿ç”¨å¤‡ç”¨çš„HTMLè½¬PDFæ–¹å¼`);
                console.error('ç›´æ¥ä¸‹è½½æµ‹è¯•å¤±è´¥:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }
        
        async function testHTMLToPDF() {
            const btn = document.getElementById('htmlToPdfBtn');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'ç”Ÿæˆä¸­...';
            
            updateResult('å¼€å§‹æµ‹è¯•HTMLè½¬PDFå¤‡ç”¨æ–¹æ¡ˆ...\n');
            
            try {
                if (typeof SimplePDFGenerator === 'undefined') {
                    throw new Error('SimplePDFGeneratoræœªåŠ è½½');
                }
                
                const testQuestions = SimplePDFGenerator.createTestQuestions();
                const generator = new SimplePDFGenerator();
                
                updateResult(`å¼€å§‹ä½¿ç”¨HTMLè½¬PDFæ–¹æ¡ˆ...\né¢˜ç›®æ•°é‡ï¼š${testQuestions.length}\n`);
                
                const success = await generator.generateHTMLToPDF(testQuestions);
                
                if (success) {
                    updateResult(`âœ… HTMLè½¬PDFå¤‡ç”¨æ–¹æ¡ˆæˆåŠŸï¼\nç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleTimeString()}\n\nå·²æ‰“å¼€æ–°çª—å£æˆ–æ˜¾ç¤ºé¢„è§ˆ\nè¯·æŒ‰æç¤ºä½¿ç”¨æµè§ˆå™¨æ‰“å°åŠŸèƒ½ä¿å­˜ä¸ºPDF`);
                } else {
                    throw new Error('HTMLè½¬PDFå¤±è´¥');
                }
                
            } catch (error) {
                updateResult(`âŒ HTMLè½¬PDFæµ‹è¯•å¤±è´¥\né”™è¯¯ä¿¡æ¯ï¼š${error.message}`);
                console.error('HTMLè½¬PDFæµ‹è¯•å¤±è´¥:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºçŠ¶æ€
        window.addEventListener('load', () => {
            const hasGenerator = typeof SimplePDFGenerator !== 'undefined';
            const hasCanvas = !!document.createElement('canvas').getContext;
            const hasBlob = typeof Blob !== 'undefined';
            
            updateResult(`é¡µé¢åŠ è½½å®Œæˆ
ç¯å¢ƒæ£€æŸ¥ï¼š
âœ“ SimplePDFGenerator: ${hasGenerator ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}
âœ“ Canvasæ”¯æŒ: ${hasCanvas ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}
âœ“ Blobæ”¯æŒ: ${hasBlob ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}

${hasGenerator && hasCanvas && hasBlob ? 'âœ… ç¯å¢ƒæ­£å¸¸ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•' : 'âŒ ç¯å¢ƒæœ‰é—®é¢˜ï¼Œå¯èƒ½æ— æ³•æ­£å¸¸ç”ŸæˆPDF'}`);
        });
    </script>
</body>
</html>