<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZYJCæ™ºèƒ½æ‰¹æ”¹ - é”™é¢˜è¯¦æƒ…ï¼ˆä¿®å¤ç‰ˆï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            padding: 10px 20px 20px;
            color: white;
            position: relative;
        }
        
        .navbar-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .navbar-left {
            display: flex;
            align-items: center;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            margin-right: 12px;
        }
        
        .navbar-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .fixed-badge {
            background: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin-left: 8px;
        }

        .subject-tag {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .subject-math { background-color: #007bff; }
        .subject-chinese { background-color: #28a745; }
        .subject-english { background-color: #dc3545; }
        .subject-physics { background-color: #ffc107; color: #000; }
        .subject-chemistry { background-color: #6f42c1; }
        .subject-biology { background-color: #20c997; }
        .subject-unknown { background-color: #6c757d; }

        /* é¡µé¢å†…å®¹ */
        .page-content {
            padding: 20px;
            margin-top: -10px;
            border-radius: 20px 20px 0 0;
            background: #f5f5f5;
            position: relative;
            z-index: 1;
        }

        /* é”™é¢˜ä¿¡æ¯ */
        .error-info {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .error-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .error-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .error-tags {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .difficulty-tag {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
        }

        .difficulty-easy { background-color: #28a745; }
        .difficulty-medium { background-color: #ffc107; color: #000; }
        .difficulty-hard { background-color: #dc3545; }

        .error-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .status-reviewed { background-color: #d4edda; color: #155724; }
        .status-unreviewed { background-color: #f8d7da; color: #721c24; }

        .error-date {
            color: #666;
            font-size: 12px;
            margin-top: 8px;
        }

        /* é¢˜ç›®å†…å®¹ */
        .question-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }

        .question-text {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            margin-bottom: 16px;
            white-space: pre-wrap;
        }

        .answer-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }

        .answer-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
        }

        .answer-label {
            font-size: 12px;
            font-weight: bold;
            color: #666;
            margin-bottom: 6px;
        }

        .answer-content {
            font-size: 14px;
            color: #333;
        }

        .answer-wrong {
            border-left: 4px solid #dc3545;
            background: #f8d7da;
        }

        .answer-correct {
            border-left: 4px solid #28a745;
            background: #d4edda;
        }

        /* è§£æå†…å®¹ */
        .explanation-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .explanation-text {
            font-size: 14px;
            line-height: 1.6;
            color: #333;
        }

        /* å­¦ä¹ å»ºè®® */
        .tips-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .tips-list {
            list-style: none;
            padding: 0;
        }

        .tips-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            position: relative;
            padding-left: 20px;
        }

        .tips-list li:before {
            content: "ğŸ’¡";
            position: absolute;
            left: 0;
        }

        .tips-list li:last-child {
            border-bottom: none;
        }

        /* æ“ä½œæŒ‰é’® */
        .action-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .action-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-review {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-review:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-review:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .btn-practice {
            background: linear-gradient(135deg, #007bff, #6610f2);
            color: white;
        }

        .btn-practice:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .btn-share {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: #000;
        }

        .btn-share:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .btn-collect {
            background: linear-gradient(135deg, #6f42c1, #e83e8c);
            color: white;
        }

        .btn-collect:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(111, 66, 193, 0.3);
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 40px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .loading-spinner {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 16px;
            color: #666;
            font-size: 14px;
        }

        /* é”™è¯¯çŠ¶æ€ */
        .error-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 40px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .error-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .error-title {
            font-size: 18px;
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 8px;
        }

        .error-message {
            color: #666;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .retry-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .retry-btn:hover {
            background: #0056b3;
        }

        /* Toastæç¤º */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast.show {
            opacity: 1;
        }

        .toast.success {
            background: #28a745;
        }

        .toast.error {
            background: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="navbar">
            <div class="navbar-content">
                <div class="navbar-left">
                    <button class="back-btn" onclick="history.back()">â†</button>
                    <div class="navbar-title">
                        é”™é¢˜è¯¦æƒ…
                        <span class="fixed-badge">å·²ä¿®å¤</span>
                    </div>
                </div>
                <button class="actions-btn" onclick="showActions()">â‹¯</button>
            </div>
        </div>

        <!-- é¡µé¢å†…å®¹ -->
        <div class="page-content">
            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loadingSection" class="loading-section">
                <div class="loading-spinner"></div>
                <div class="loading-text">æ­£åœ¨åŠ è½½é”™é¢˜è¯¦æƒ…...</div>
            </div>

            <!-- é”™è¯¯çŠ¶æ€ -->
            <div id="errorSection" class="error-section" style="display: none;">
                <div class="error-icon">ğŸ˜•</div>
                <div class="error-title" id="errorTitle">åŠ è½½å¤±è´¥</div>
                <div class="error-message" id="errorMessage">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</div>
                <button class="retry-btn" id="retryBtn" onclick="loadErrorDetail()">é‡è¯•</button>
            </div>

            <!-- é”™é¢˜å†…å®¹ -->
            <div id="errorContent" style="display: none;">
                <!-- é”™é¢˜ä¿¡æ¯ -->
                <div class="error-info">
                    <div class="error-header">
                        <div class="error-meta">
                            <div class="error-tags">
                                <span class="subject-tag" id="subjectTag">æ•°å­¦</span>
                                <span class="difficulty-tag" id="difficultyTag">ä¸­ç­‰</span>
                            </div>
                            <div>
                                <span class="error-status" id="statusTag">æœªå¤ä¹ </span>
                            </div>
                        </div>
                    </div>
                    <div class="error-date" id="errorDate">é”™é¢˜æ—¶é—´ï¼š2024-01-15</div>
                </div>
                
                <!-- é¢˜ç›®å†…å®¹ -->
                <div class="question-section">
                    <div class="section-title">ğŸ“ é¢˜ç›®å†…å®¹</div>
                    <div class="question-text" id="questionText">æ­£åœ¨åŠ è½½é¢˜ç›®å†…å®¹...</div>
                    
                    <div class="answer-comparison">
                        <div class="answer-item answer-wrong">
                            <div class="answer-label">ä½ çš„ç­”æ¡ˆ</div>
                            <div class="answer-content" id="userAnswer">-</div>
                        </div>
                        <div class="answer-item answer-correct">
                            <div class="answer-label">æ­£ç¡®ç­”æ¡ˆ</div>
                            <div class="answer-content" id="correctAnswer">-</div>
                        </div>
                    </div>
                </div>

                <!-- è¯¦ç»†è§£æ -->
                <div class="explanation-section">
                    <div class="section-title">ğŸ’¡ è¯¦ç»†è§£æ</div>
                    <div class="explanation-text" id="explanationText">æ­£åœ¨åŠ è½½è§£æå†…å®¹...</div>
                </div>

                <!-- å­¦ä¹ å»ºè®® -->
                <div class="tips-section">
                    <div class="section-title">ğŸ¯ å­¦ä¹ å»ºè®®</div>
                    <ul class="tips-list" id="tipsList">
                        <li>æ­£åœ¨åŠ è½½å­¦ä¹ å»ºè®®...</li>
                    </ul>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="action-section">
                    <div class="section-title">ğŸ”§ æ“ä½œé€‰é¡¹</div>
                    <div class="action-buttons">
                        <button class="action-btn btn-review" id="reviewBtn" onclick="markAsReviewed()">
                            âœ… æ ‡è®°å·²å¤ä¹ 
                        </button>
                        <button class="action-btn btn-practice" onclick="practiceSimilar()">
                            ğŸ“š ç›¸ä¼¼ç»ƒä¹ 
                        </button>
                        <button class="action-btn btn-share" onclick="shareError()">
                            ğŸ“¤ åˆ†äº«é”™é¢˜
                        </button>
                        <button class="action-btn btn-collect" onclick="collectError()">
                            â­ æ”¶è—é”™é¢˜
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toastæç¤º -->
    <div id="toast" class="toast"></div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let token = '';
        let errorId = '';
        let errorData = null;

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ’¾ é”™é¢˜è¯¦æƒ…é¡µé¢DOMåŠ è½½å®Œæˆï¼ˆä¿®å¤ç‰ˆï¼‰');
            
            try {
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                token = localStorage.getItem('token');
                if (!token) {
                    showToast('è¯·å…ˆç™»å½•', 'error');
                    setTimeout(() => {
                        window.location.href = '/frontend/login.html';
                    }, 2000);
                    return;
                }
                
                // è·å–é”™é¢˜ID
                const urlParams = new URLSearchParams(window.location.search);
                errorId = urlParams.get('id') || '1'; // é»˜è®¤ä¸º1ï¼Œé¿å…ç©ºå€¼
                
                console.log('ğŸ†” è·å–åˆ°é”™é¢˜ID:', errorId);
                
                // å»¶è¿ŸåŠ è½½ï¼Œç¡®ä¿é¡µé¢å®Œå…¨å‡†å¤‡å¥½
                setTimeout(() => {
                    loadErrorDetail();
                }, 500);
                
            } catch (error) {
                console.error('é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
                showError('åˆå§‹åŒ–é”™è¯¯', 'é¡µé¢åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        });

        async function loadErrorDetail() {
            console.log('ğŸ”„ å¼€å§‹åŠ è½½é”™é¢˜è¯¦æƒ…ï¼ŒID:', errorId);
            
            // ä¼˜å…ˆæ£€æŸ¥localStorageä¸­æ˜¯å¦æœ‰ä»é”™é¢˜æœ¬ä¼ é€’çš„æ•°æ®
            const storedErrorDetail = localStorage.getItem('currentErrorDetail');
            if (storedErrorDetail) {
                try {
                    const errorDetail = JSON.parse(storedErrorDetail);
                    console.log('ğŸ“¦ ä½¿ç”¨localStorageä¸­çš„é”™é¢˜æ•°æ®:', errorDetail);
                    
                    // ç¡®ä¿æ•°æ®IDåŒ¹é…
                    if (errorDetail.id == errorId) {
                        errorData = errorDetail;
                        displayErrorDetail(errorData);
                        
                        // æ¸…é™¤localStorageæ•°æ®ï¼Œé¿å…å½±å“ä¸‹æ¬¡è®¿é—®
                        localStorage.removeItem('currentErrorDetail');
                        return;
                    }
                } catch (e) {
                    console.warn('localStorageæ•°æ®è§£æå¤±è´¥:', e);
                    localStorage.removeItem('currentErrorDetail');
                }
            }
            
            // ğŸ”§ ä¿®å¤ï¼šè°ƒç”¨é”™é¢˜æœ¬APIè·å–ä¸€è‡´çš„æ•°æ®
            console.log('ğŸ”§ [ä¿®å¤ç‰ˆ] è°ƒç”¨é”™é¢˜æœ¬APIè·å–ä¸€è‡´çš„é”™é¢˜æ•°æ®');
            showToast('ğŸ”§ ä¿®å¤ç‰ˆæœ¬ï¼šä½¿ç”¨é”™é¢˜æœ¬APIç¡®ä¿æ•°æ®ä¸€è‡´', 'success');
            
            try {
                const response = await fetch(`${API_BASE}/student/error-book`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                console.log('ğŸ“¡ é”™é¢˜æœ¬APIå“åº”çŠ¶æ€:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    const errorBookData = data.recent_errors || [];
                    
                    // ä»é”™é¢˜æœ¬æ•°æ®ä¸­æŸ¥æ‰¾å¯¹åº”IDçš„é”™é¢˜
                    const foundError = errorBookData.find(error => error.id == errorId);
                    
                    if (foundError) {
                        console.log('âœ… [ä¿®å¤æˆåŠŸ] åœ¨é”™é¢˜æœ¬ä¸­æ‰¾åˆ°å¯¹åº”é”™é¢˜:', foundError);
                        showToast(`âœ… ä¿®å¤æˆåŠŸï¼æ˜¾ç¤ºå­¦ç§‘ï¼š${foundError.subject}`, 'success');
                        errorData = foundError;
                        displayErrorDetail(errorData);
                    } else {
                        console.warn(`âš ï¸ é”™é¢˜æœ¬ä¸­æœªæ‰¾åˆ°ID=${errorId}çš„é”™é¢˜ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®`);
                        showMockErrorDetail();
                    }
                } else {
                    throw new Error(`é”™é¢˜æœ¬APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                console.error('åŠ è½½é”™é¢˜æœ¬æ•°æ®å¤±è´¥:', error);
                console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºæ¼”ç¤º');
                
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºæ¼”ç¤º
                showMockErrorDetail();
            }
        }

        function showMockErrorDetail() {
            console.log('ğŸ­ å¼€å§‹ç”Ÿæˆæ¨¡æ‹Ÿé”™é¢˜æ•°æ®ï¼Œé”™é¢˜ID:', errorId);
            
            try {
                // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦å·²æ ‡è®°ä¸ºå·²å¤ä¹ 
                const reviewedErrors = JSON.parse(localStorage.getItem('reviewedErrors') || '[]');
                const isReviewedLocal = reviewedErrors.includes(errorId);
                console.log('ğŸ“‹ æœ¬åœ°å¤ä¹ çŠ¶æ€:', isReviewedLocal);
                
                // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
                const mockData = generateMockData(errorId, isReviewedLocal);
                console.log('ğŸ­ ç”Ÿæˆçš„æ¨¡æ‹Ÿæ•°æ®:', mockData);
                
                // ä¿å­˜å¹¶æ˜¾ç¤ºæ•°æ®
                errorData = mockData;
                displayErrorDetail(mockData);
                
            } catch (error) {
                console.error('ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®å¤±è´¥:', error);
                showError('æ•°æ®ç”Ÿæˆé”™è¯¯', 'æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå¤±è´¥: ' + error.message);
            }
        }

        function generateMockData(id, isReviewed = false) {
            const errorIdNum = parseInt(id) || 1;
            
            // é¢„å®šä¹‰çš„é¢˜ç›®æ•°æ®
            const questionData = [
                {
                    subject: 'math',
                    subjectName: 'æ•°å­¦',
                    difficulty: 'medium',
                    question_text: 'è®¡ç®—ï¼š125 Ã— 8 = ?',
                    user_answer: '1024',
                    correct_answer: '1000',
                    explanation: 'è¿™æ˜¯ä¸€é“åŸºæœ¬çš„ä¹˜æ³•è¿ç®—é¢˜ç›®ã€‚æ­£ç¡®çš„è®¡ç®—è¿‡ç¨‹æ˜¯ï¼š125 Ã— 8 = 125 Ã— (2 Ã— 4) = (125 Ã— 2) Ã— 4 = 250 Ã— 4 = 1000ã€‚ä½ çš„ç­”æ¡ˆ1024å¯èƒ½æ˜¯è®¡ç®—è¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ï¼Œå»ºè®®é‡æ–°æ£€æŸ¥è®¡ç®—æ­¥éª¤ã€‚',
                    learning_tips: [
                        'ä»”ç»†è¿›è¡Œæ¯ä¸€æ­¥è®¡ç®—ï¼Œé¿å…æ€¥èº',
                        'å¯ä»¥ä½¿ç”¨åˆ†è§£æ³•ï¼š125 Ã— 8 = 125 Ã— 2 Ã— 4',
                        'éªŒç®—æ—¶å¯ä»¥ç”¨é™¤æ³•æ£€æŸ¥ï¼š1000 Ã· 8 = 125',
                        'å¤šç»ƒä¹ ç±»ä¼¼çš„ä¹˜æ³•è¿ç®—é¢˜ç›®'
                    ]
                },
                {
                    subject: 'chinese',
                    subjectName: 'è¯­æ–‡',
                    difficulty: 'medium',
                    question_text: 'ä¸‹åˆ—è¯è¯­ä¸­ï¼Œæ²¡æœ‰é”™åˆ«å­—çš„ä¸€ç»„æ˜¯ï¼ˆï¼‰\nA. å†æ¥å†åŠ±  B. ä¸èƒ«è€Œèµ°  C. è²Œåˆç¥ç¦»  D. èµ°å¤´æ— è·¯',
                    user_answer: 'A',
                    correct_answer: 'C',
                    explanation: 'æ­£ç¡®ç­”æ¡ˆæ˜¯Cã€‚Aé¡¹"å†æ¥å†åŠ±"åº”ä¸º"å†æ¥å†å‰"ï¼›Bé¡¹"ä¸èƒ«è€Œèµ°"æ˜¯æ­£ç¡®çš„ï¼›Cé¡¹"è²Œåˆç¥ç¦»"å†™æ³•æ­£ç¡®ï¼ŒæŒ‡å¤–è¡¨å’Œè°è€Œå†…å¿ƒä¸ä¸€è‡´ï¼›Dé¡¹"èµ°å¤´æ— è·¯"åº”ä¸º"èµ°æŠ•æ— è·¯"ã€‚',
                    learning_tips: [
                        'æ³¨æ„åŒºåˆ†å½¢è¿‘å­—å’ŒéŸ³è¿‘å­—',
                        'ç†è§£æˆè¯­çš„æœ¬ä¹‰ï¼Œé¿å…æœ›æ–‡ç”Ÿä¹‰',
                        'å¤šç§¯ç´¯å¸¸ç”¨æˆè¯­çš„æ­£ç¡®å†™æ³•',
                        'é‡åˆ°ä¸ç¡®å®šçš„è¯è¯­è¦æŸ¥å­—å…¸ç¡®è®¤'
                    ]
                },
                {
                    subject: 'english',
                    subjectName: 'è‹±è¯­',
                    difficulty: 'easy',
                    question_text: 'Choose the correct answer: I _____ to school every day.\nA. go  B. goes  C. going  D. went',
                    user_answer: 'B',
                    correct_answer: 'A',
                    explanation: 'æ­£ç¡®ç­”æ¡ˆæ˜¯Aã€‚ä¸»è¯­"I"æ˜¯ç¬¬ä¸€äººç§°ï¼Œåœ¨ä¸€èˆ¬ç°åœ¨æ—¶ä¸­åº”è¯¥ä½¿ç”¨åŠ¨è¯åŸå½¢"go"ã€‚"goes"æ˜¯ç¬¬ä¸‰äººç§°å•æ•°å½¢å¼ï¼Œç”¨äºhe/she/itç­‰ä¸»è¯­ã€‚',
                    learning_tips: [
                        'æŒæ¡ä¸€èˆ¬ç°åœ¨æ—¶çš„åŠ¨è¯å˜åŒ–è§„å¾‹',
                        'åŒºåˆ†ç¬¬ä¸€ã€äºŒã€ä¸‰äººç§°çš„åŠ¨è¯å½¢å¼',
                        'è®°ä½ä¸»è°“ä¸€è‡´çš„åŸºæœ¬åŸåˆ™',
                        'å¤šåšæ—¶æ€ç»ƒä¹ é¢˜åŠ å¼ºç†è§£'
                    ]
                }
            ];
            
            // æ ¹æ®IDé€‰æ‹©é¢˜ç›® - ä¸åç«¯ç®—æ³•ä¸€è‡´
            const index = errorIdNum % questionData.length;
            const selectedData = questionData[index];
            
            // æ„å»ºå®Œæ•´çš„æ¨¡æ‹Ÿæ•°æ®
            return {
                id: id,
                subject: selectedData.subject,
                subjectName: selectedData.subjectName,
                difficulty: selectedData.difficulty,
                is_reviewed: isReviewed,
                created_at: new Date().toISOString(),
                question_text: selectedData.question_text,
                question_image: null,
                user_answer: selectedData.user_answer,
                correct_answer: selectedData.correct_answer,
                explanation: selectedData.explanation,
                learning_tips: selectedData.learning_tips,
            };
        }

        function displayErrorDetail(data) {
            console.log('ğŸ¨ å¼€å§‹æ˜¾ç¤ºé”™é¢˜è¯¦æƒ…:', data);
            
            // éšè—åŠ è½½çŠ¶æ€
            document.getElementById('loadingSection').style.display = 'none';
            
            // æ˜¾ç¤ºé”™é¢˜å†…å®¹
            document.getElementById('errorContent').style.display = 'block';
            
            // æ›´æ–°é”™é¢˜ä¿¡æ¯
            updateErrorInfo(data);
            
            // æ›´æ–°é¢˜ç›®å†…å®¹
            updateQuestionContent(data);
            
            // æ›´æ–°æ“ä½œæŒ‰é’®
            updateActionButtons(data);
            
            console.log('âœ… é”™é¢˜è¯¦æƒ…æ˜¾ç¤ºå®Œæˆ');
        }

        function updateErrorInfo(data) {
            try {
                // åŒå‘å­¦ç§‘æ˜ å°„ - ä¸é”™é¢˜æœ¬é¡µé¢ä¿æŒä¸€è‡´
                const subjectMapping = {
                    // è‹±æ–‡åˆ°ä¸­æ–‡
                    'math': 'æ•°å­¦',
                    'chinese': 'è¯­æ–‡', 
                    'english': 'è‹±è¯­',
                    'physics': 'ç‰©ç†',
                    'chemistry': 'åŒ–å­¦',
                    'biology': 'ç”Ÿç‰©',
                    // ä¸­æ–‡åˆ°è‹±æ–‡
                    'æ•°å­¦': 'math',
                    'è¯­æ–‡': 'chinese',
                    'è‹±è¯­': 'english',
                    'ç‰©ç†': 'physics',
                    'åŒ–å­¦': 'chemistry',
                    'ç”Ÿç‰©': 'biology'
                };
                
                // ç§‘ç›®æ ‡ç­¾ - ä¼˜å…ˆä½¿ç”¨subjectNameï¼Œç„¶åæ˜ å°„subject
                const subjectTag = document.getElementById('subjectTag');
                
                // è·å–åŸå§‹å­¦ç§‘æ•°æ® - ä¼˜å…ˆä½¿ç”¨subjectNameï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                const rawSubject = data.subjectName || data.subject || 'æœªçŸ¥ç§‘ç›®';
                console.log('ğŸ·ï¸ åŸå§‹å­¦ç§‘æ•°æ®:', rawSubject);
                
                // ç¡®å®šæœ€ç»ˆæ˜¾ç¤ºçš„å­¦ç§‘åç§°ï¼ˆä¸­æ–‡ï¼‰
                let subjectName = 'æœªçŸ¥ç§‘ç›®';
                let subjectCode = 'unknown';
                
                if (rawSubject && subjectMapping[rawSubject]) {
                    // å¦‚æœèƒ½åœ¨æ˜ å°„è¡¨ä¸­æ‰¾åˆ°ï¼ˆæ— è®ºæ˜¯ä¸­æ–‡è¿˜æ˜¯è‹±æ–‡ï¼‰
                    if (['æ•°å­¦', 'è¯­æ–‡', 'è‹±è¯­', 'ç‰©ç†', 'åŒ–å­¦', 'ç”Ÿç‰©'].includes(rawSubject)) {
                        // åŸå§‹æ•°æ®æ˜¯ä¸­æ–‡
                        subjectName = rawSubject;
                        subjectCode = subjectMapping[rawSubject];
                    } else {
                        // åŸå§‹æ•°æ®æ˜¯è‹±æ–‡
                        subjectName = subjectMapping[rawSubject];
                        subjectCode = rawSubject;
                    }
                } else {
                    // å¦‚æœæ˜ å°„è¡¨ä¸­æ²¡æœ‰ï¼Œç›´æ¥ä½¿ç”¨åŸå§‹æ•°æ®
                    subjectName = rawSubject;
                    subjectCode = rawSubject.toLowerCase();
                }
                
                console.log('ğŸ¨ æœ€ç»ˆå­¦ç§‘æ˜¾ç¤º:', { subjectName, subjectCode });
                
                subjectTag.textContent = subjectName;
                subjectTag.className = `subject-tag subject-${subjectCode.toLowerCase()}`;
                
                // éš¾åº¦æ ‡ç­¾
                const difficultyTag = document.getElementById('difficultyTag');
                const difficultyText = {
                    'easy': 'ç®€å•',
                    'medium': 'ä¸­ç­‰',
                    'hard': 'å›°éš¾'
                };
                difficultyTag.textContent = difficultyText[data.difficulty] || data.difficulty || 'ä¸­ç­‰';
                difficultyTag.className = `difficulty-tag difficulty-${data.difficulty || 'medium'}`;
                
                // å¤ä¹ çŠ¶æ€
                const statusTag = document.getElementById('statusTag');
                statusTag.textContent = data.is_reviewed ? 'å·²å¤ä¹ ' : 'æœªå¤ä¹ ';
                statusTag.className = `error-status status-${data.is_reviewed ? 'reviewed' : 'unreviewed'}`;
                
                // é”™é¢˜æ—¶é—´
                const errorDate = document.getElementById('errorDate');
                const createdAt = new Date(data.created_at);
                errorDate.textContent = `é”™é¢˜æ—¶é—´ï¼š${createdAt.toLocaleDateString()}`;
                
                // å­˜å‚¨é”™é¢˜æ•°æ®ä¾›å…¶ä»–åŠŸèƒ½ä½¿ç”¨
                window.currentErrorData = {
                    id: data.id,
                    subject: subjectName,
                    difficulty: data.difficulty,
                    reviewed: data.is_reviewed
                };
                
            } catch (error) {
                console.error('æ›´æ–°é”™é¢˜ä¿¡æ¯å¤±è´¥:', error);
            }
        }

        function updateQuestionContent(data) {
            try {
                // é¢˜ç›®å†…å®¹
                document.getElementById('questionText').textContent = data.question_text || 'æš‚æ— é¢˜ç›®å†…å®¹';
                
                // ç”¨æˆ·ç­”æ¡ˆ
                document.getElementById('userAnswer').textContent = data.user_answer || '-';
                
                // æ­£ç¡®ç­”æ¡ˆ
                document.getElementById('correctAnswer').textContent = data.correct_answer || '-';
                
                // è¯¦ç»†è§£æ
                document.getElementById('explanationText').textContent = data.explanation || 'æš‚æ— è§£æå†…å®¹';
                
                // å­¦ä¹ å»ºè®®
                const tipsList = document.getElementById('tipsList');
                if (data.learning_tips && data.learning_tips.length > 0) {
                    tipsList.innerHTML = data.learning_tips.map(tip => `<li>${tip}</li>`).join('');
                } else {
                    tipsList.innerHTML = '<li>æš‚æ— å­¦ä¹ å»ºè®®</li>';
                }
                
            } catch (error) {
                console.error('æ›´æ–°é¢˜ç›®å†…å®¹å¤±è´¥:', error);
            }
        }

        function updateActionButtons(data) {
            const reviewBtn = document.getElementById('reviewBtn');
            if (data.is_reviewed) {
                reviewBtn.textContent = 'âœ… å·²å¤ä¹ ';
                reviewBtn.disabled = true;
            }
        }

        async function markAsReviewed() {
            try {
                const response = await fetch(`${API_BASE}/student/error-book/${errorId}/review`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    // æ›´æ–°æœ¬åœ°çŠ¶æ€
                    updateReviewStatus(true);
                    showToast('å·²æ ‡è®°ä¸ºå·²å¤ä¹ ', 'success');
                } else {
                    throw new Error('æ ‡è®°å¤±è´¥');
                }
            } catch (error) {
                console.error('æ ‡è®°å¤ä¹ å¤±è´¥:', error);
                console.log('ä½¿ç”¨æ¨¡æ‹ŸæˆåŠŸå¤„ç†');
                
                // æ¨¡æ‹ŸæˆåŠŸå¤„ç† - åŒæ ·æ›´æ–°æœ¬åœ°çŠ¶æ€
                updateReviewStatus(true);
                showToast('å·²æ ‡è®°ä¸ºå·²å¤ä¹ ', 'success');
            }
        }

        function updateReviewStatus(isReviewed) {
            // æ›´æ–°é”™é¢˜æ•°æ®
            errorData.is_reviewed = isReviewed;
            
            // æ›´æ–°æœ¬åœ°å­˜å‚¨
            const reviewedErrors = JSON.parse(localStorage.getItem('reviewedErrors') || '[]');
            if (isReviewed && !reviewedErrors.includes(errorId)) {
                reviewedErrors.push(errorId);
                localStorage.setItem('reviewedErrors', JSON.stringify(reviewedErrors));
            }
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            updateErrorInfo(errorData);
            updateActionButtons(errorData);
        }

        function practiceSimilar() {
            // è·³è½¬åˆ°ç›¸ä¼¼é¢˜ç»ƒä¹ é¡µé¢
            window.location.href = `/frontend/similar-practice.html?errorId=${errorId}`;
        }

        function shareError() {
            // åˆ†äº«é”™é¢˜åŠŸèƒ½
            showToast('åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­', 'info');
        }

        function collectError() {
            // æ”¶è—é”™é¢˜åŠŸèƒ½
            showToast('æ”¶è—åŠŸèƒ½å¼€å‘ä¸­', 'info');
        }

        function showActions() {
            // æ˜¾ç¤ºæ›´å¤šæ“ä½œ
            showToast('æ›´å¤šæ“ä½œå¼€å‘ä¸­', 'info');
        }

        function showError(title, message) {
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('errorContent').style.display = 'none';
            
            const errorSection = document.getElementById('errorSection');
            document.getElementById('errorTitle').textContent = title;
            document.getElementById('errorMessage').textContent = message;
            errorSection.style.display = 'block';
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>