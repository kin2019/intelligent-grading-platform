<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZYJCÊô∫ËÉΩÊâπÊîπ - ÈîôÈ¢òËØ¶ÊÉÖÔºà‰øÆÂ§çÁâàÔºâ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        /* È°∂ÈÉ®ÂØºËà™Ê†è */
        .navbar {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            padding: 10px 20px 20px;
            color: white;
            position: relative;
        }
        
        .navbar-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .navbar-left {
            display: flex;
            align-items: center;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            margin-right: 12px;
        }
        
        .navbar-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .fixed-badge {
            background: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin-left: 8px;
        }

        .subject-tag {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .subject-math { background-color: #007bff; }
        .subject-chinese { background-color: #28a745; }
        .subject-english { background-color: #dc3545; }
        .subject-physics { background-color: #ffc107; color: #000; }
        .subject-chemistry { background-color: #6f42c1; }
        .subject-biology { background-color: #20c997; }
        .subject-unknown { background-color: #6c757d; }

        /* È°µÈù¢ÂÜÖÂÆπ */
        .page-content {
            padding: 20px;
            margin-top: -10px;
            border-radius: 20px 20px 0 0;
            background: #f5f5f5;
            position: relative;
            z-index: 1;
        }

        /* ÈîôÈ¢ò‰ø°ÊÅØ */
        .error-info {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .error-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .error-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .error-tags {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .difficulty-tag {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
        }

        .difficulty-easy { background-color: #28a745; }
        .difficulty-medium { background-color: #ffc107; color: #000; }
        .difficulty-hard { background-color: #dc3545; }

        .error-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .status-reviewed { background-color: #d4edda; color: #155724; }
        .status-unreviewed { background-color: #f8d7da; color: #721c24; }

        .error-date {
            color: #666;
            font-size: 12px;
            margin-top: 8px;
        }

        /* È¢òÁõÆÂÜÖÂÆπ */
        .question-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }

        .question-text {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            margin-bottom: 16px;
            white-space: pre-wrap;
        }

        .answer-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }

        .answer-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
        }

        .answer-label {
            font-size: 12px;
            font-weight: bold;
            color: #666;
            margin-bottom: 6px;
        }

        .answer-content {
            font-size: 14px;
            color: #333;
        }

        .answer-wrong {
            border-left: 4px solid #dc3545;
            background: #f8d7da;
        }

        .answer-correct {
            border-left: 4px solid #28a745;
            background: #d4edda;
        }

        /* Ëß£ÊûêÂÜÖÂÆπ */
        .explanation-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .explanation-text {
            font-size: 14px;
            line-height: 1.6;
            color: #333;
        }

        /* Â≠¶‰π†Âª∫ËÆÆ */
        .tips-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .tips-list {
            list-style: none;
            padding: 0;
        }

        .tips-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            position: relative;
            padding-left: 20px;
        }

        .tips-list li:before {
            content: "üí°";
            position: absolute;
            left: 0;
        }

        .tips-list li:last-child {
            border-bottom: none;
        }

        /* Êìç‰ΩúÊåâÈíÆ */
        .action-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .action-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-review {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-review:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-review:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .btn-practice {
            background: linear-gradient(135deg, #007bff, #6610f2);
            color: white;
        }

        .btn-practice:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .btn-share {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: #000;
        }

        .btn-share:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .btn-collect {
            background: linear-gradient(135deg, #6f42c1, #e83e8c);
            color: white;
        }

        .btn-collect:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(111, 66, 193, 0.3);
        }

        /* Âä†ËΩΩÁä∂ÊÄÅ */
        .loading-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 40px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .loading-spinner {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 16px;
            color: #666;
            font-size: 14px;
        }

        /* ÈîôËØØÁä∂ÊÄÅ */
        .error-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 40px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .error-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .error-title {
            font-size: 18px;
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 8px;
        }

        .error-message {
            color: #666;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .retry-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .retry-btn:hover {
            background: #0056b3;
        }

        /* ToastÊèêÁ§∫ */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast.show {
            opacity: 1;
        }

        .toast.success {
            background: #28a745;
        }

        .toast.error {
            background: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
        <div class="navbar">
            <div class="navbar-content">
                <div class="navbar-left">
                    <button class="back-btn" onclick="history.back()">‚Üê</button>
                    <div class="navbar-title">
                        ÈîôÈ¢òËØ¶ÊÉÖ
                        <span class="fixed-badge">Â∑≤‰øÆÂ§ç</span>
                    </div>
                </div>
                <button class="actions-btn" onclick="showActions()">‚ãØ</button>
            </div>
        </div>

        <!-- È°µÈù¢ÂÜÖÂÆπ -->
        <div class="page-content">
            <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
            <div id="loadingSection" class="loading-section">
                <div class="loading-spinner"></div>
                <div class="loading-text">Ê≠£Âú®Âä†ËΩΩÈîôÈ¢òËØ¶ÊÉÖ...</div>
            </div>

            <!-- ÈîôËØØÁä∂ÊÄÅ -->
            <div id="errorSection" class="error-section" style="display: none;">
                <div class="error-icon">üòï</div>
                <div class="error-title" id="errorTitle">Âä†ËΩΩÂ§±Ë¥•</div>
                <div class="error-message" id="errorMessage">ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂêéÈáçËØï</div>
                <button class="retry-btn" id="retryBtn" onclick="loadErrorDetail()">ÈáçËØï</button>
            </div>

            <!-- ÈîôÈ¢òÂÜÖÂÆπ -->
            <div id="errorContent" style="display: none;">
                <!-- ÈîôÈ¢ò‰ø°ÊÅØ -->
                <div class="error-info">
                    <div class="error-header">
                        <div class="error-meta">
                            <div class="error-tags">
                                <span class="subject-tag" id="subjectTag">Êï∞Â≠¶</span>
                                <span class="difficulty-tag" id="difficultyTag">‰∏≠Á≠â</span>
                            </div>
                            <div>
                                <span class="error-status" id="statusTag">Êú™Â§ç‰π†</span>
                            </div>
                        </div>
                    </div>
                    <div class="error-date" id="errorDate">ÈîôÈ¢òÊó∂Èó¥Ôºö2024-01-15</div>
                </div>
                
                <!-- È¢òÁõÆÂÜÖÂÆπ -->
                <div class="question-section">
                    <div class="section-title">üìù È¢òÁõÆÂÜÖÂÆπ</div>
                    <div class="question-text" id="questionText">Ê≠£Âú®Âä†ËΩΩÈ¢òÁõÆÂÜÖÂÆπ...</div>
                    
                    <div class="answer-comparison">
                        <div class="answer-item answer-wrong">
                            <div class="answer-label">‰Ω†ÁöÑÁ≠îÊ°à</div>
                            <div class="answer-content" id="userAnswer">-</div>
                        </div>
                        <div class="answer-item answer-correct">
                            <div class="answer-label">Ê≠£Á°ÆÁ≠îÊ°à</div>
                            <div class="answer-content" id="correctAnswer">-</div>
                        </div>
                    </div>
                </div>

                <!-- ËØ¶ÁªÜËß£Êûê -->
                <div class="explanation-section">
                    <div class="section-title">üí° ËØ¶ÁªÜËß£Êûê</div>
                    <div class="explanation-text" id="explanationText">Ê≠£Âú®Âä†ËΩΩËß£ÊûêÂÜÖÂÆπ...</div>
                </div>

                <!-- Â≠¶‰π†Âª∫ËÆÆ -->
                <div class="tips-section">
                    <div class="section-title">üéØ Â≠¶‰π†Âª∫ËÆÆ</div>
                    <ul class="tips-list" id="tipsList">
                        <li>Ê≠£Âú®Âä†ËΩΩÂ≠¶‰π†Âª∫ËÆÆ...</li>
                    </ul>
                </div>

                <!-- Êìç‰ΩúÊåâÈíÆ -->
                <div class="action-section">
                    <div class="section-title">üîß Êìç‰ΩúÈÄâÈ°π</div>
                    <div class="action-buttons">
                        <button class="action-btn btn-review" id="reviewBtn" onclick="markAsReviewed()">
                            ‚úÖ Ê†áËÆ∞Â∑≤Â§ç‰π†
                        </button>
                        <button class="action-btn btn-practice" onclick="practiceSimilar()">
                            üìö Áõ∏‰ººÁªÉ‰π†
                        </button>
                        <button class="action-btn btn-share" onclick="shareError()">
                            üì§ ÂàÜ‰∫´ÈîôÈ¢ò
                        </button>
                        <button class="action-btn btn-collect" onclick="collectError()">
                            ‚≠ê Êî∂ËóèÈîôÈ¢ò
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ToastÊèêÁ§∫ -->
    <div id="toast" class="toast"></div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let token = '';
        let errorId = '';
        let errorData = null;

        // È°µÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üíæ ÈîôÈ¢òËØ¶ÊÉÖÈ°µÈù¢DOMÂä†ËΩΩÂÆåÊàêÔºà‰øÆÂ§çÁâàÔºâ');
            
            try {
                // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
                token = localStorage.getItem('token');
                if (!token) {
                    showToast('ËØ∑ÂÖàÁôªÂΩï', 'error');
                    setTimeout(() => {
                        window.location.href = '/frontend/login.html';
                    }, 2000);
                    return;
                }
                
                // Ëé∑ÂèñÈîôÈ¢òID
                const urlParams = new URLSearchParams(window.location.search);
                errorId = urlParams.get('id') || '1'; // ÈªòËÆ§‰∏∫1ÔºåÈÅøÂÖçÁ©∫ÂÄº
                
                console.log('üÜî Ëé∑ÂèñÂà∞ÈîôÈ¢òID:', errorId);
                
                // Âª∂ËøüÂä†ËΩΩÔºåÁ°Æ‰øùÈ°µÈù¢ÂÆåÂÖ®ÂáÜÂ§áÂ•Ω
                setTimeout(() => {
                    loadErrorDetail();
                }, 500);
                
            } catch (error) {
                console.error('È°µÈù¢ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                showError('ÂàùÂßãÂåñÈîôËØØ', 'È°µÈù¢ÂàùÂßãÂåñÂ§±Ë¥•: ' + error.message);
            }
        });

        async function loadErrorDetail() {
            console.log('üîÑ ÂºÄÂßãÂä†ËΩΩÈîôÈ¢òËØ¶ÊÉÖÔºåID:', errorId);
            
            // ‰ºòÂÖàÊ£ÄÊü•localStorage‰∏≠ÊòØÂê¶Êúâ‰ªéÈîôÈ¢òÊú¨‰º†ÈÄíÁöÑÊï∞ÊçÆ
            const storedErrorDetail = localStorage.getItem('currentErrorDetail');
            if (storedErrorDetail) {
                try {
                    const errorDetail = JSON.parse(storedErrorDetail);
                    console.log('üì¶ ‰ΩøÁî®localStorage‰∏≠ÁöÑÈîôÈ¢òÊï∞ÊçÆ:', errorDetail);
                    
                    // Á°Æ‰øùÊï∞ÊçÆIDÂåπÈÖç
                    if (errorDetail.id == errorId) {
                        errorData = errorDetail;
                        displayErrorDetail(errorData);
                        
                        // Ê∏ÖÈô§localStorageÊï∞ÊçÆÔºåÈÅøÂÖçÂΩ±Âìç‰∏ãÊ¨°ËÆøÈóÆ
                        localStorage.removeItem('currentErrorDetail');
                        return;
                    }
                } catch (e) {
                    console.warn('localStorageÊï∞ÊçÆËß£ÊûêÂ§±Ë¥•:', e);
                    localStorage.removeItem('currentErrorDetail');
                }
            }
            
            // üîß ‰øÆÂ§çÔºöË∞ÉÁî®ÈîôÈ¢òÊú¨APIËé∑Âèñ‰∏ÄËá¥ÁöÑÊï∞ÊçÆ
            console.log('üîß [‰øÆÂ§çÁâà] Ë∞ÉÁî®ÈîôÈ¢òÊú¨APIËé∑Âèñ‰∏ÄËá¥ÁöÑÈîôÈ¢òÊï∞ÊçÆ');
            showToast('üîß ‰øÆÂ§çÁâàÊú¨Ôºö‰ΩøÁî®ÈîôÈ¢òÊú¨APIÁ°Æ‰øùÊï∞ÊçÆ‰∏ÄËá¥', 'success');
            
            try {
                const response = await fetch(`${API_BASE}/student/error-book`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                console.log('üì° ÈîôÈ¢òÊú¨APIÂìçÂ∫îÁä∂ÊÄÅ:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    const errorBookData = data.recent_errors || [];
                    
                    // ‰ªéÈîôÈ¢òÊú¨Êï∞ÊçÆ‰∏≠Êü•ÊâæÂØπÂ∫îIDÁöÑÈîôÈ¢ò
                    const foundError = errorBookData.find(error => error.id == errorId);
                    
                    if (foundError) {
                        console.log('‚úÖ [‰øÆÂ§çÊàêÂäü] Âú®ÈîôÈ¢òÊú¨‰∏≠ÊâæÂà∞ÂØπÂ∫îÈîôÈ¢ò:', foundError);
                        showToast(`‚úÖ ‰øÆÂ§çÊàêÂäüÔºÅÊòæÁ§∫Â≠¶ÁßëÔºö${foundError.subject}`, 'success');
                        errorData = foundError;
                        displayErrorDetail(errorData);
                    } else {
                        console.warn(`‚ö†Ô∏è ÈîôÈ¢òÊú¨‰∏≠Êú™ÊâæÂà∞ID=${errorId}ÁöÑÈîôÈ¢òÔºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ`);
                        showMockErrorDetail();
                    }
                } else {
                    throw new Error(`ÈîôÈ¢òÊú¨APIËØ∑Ê±ÇÂ§±Ë¥•: ${response.status}`);
                }
            } catch (error) {
                console.error('Âä†ËΩΩÈîôÈ¢òÊú¨Êï∞ÊçÆÂ§±Ë¥•:', error);
                console.log('‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ‰Ωú‰∏∫ÊºîÁ§∫');
                
                // ‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ‰Ωú‰∏∫ÊºîÁ§∫
                showMockErrorDetail();
            }
        }

        function showMockErrorDetail() {
            console.log('üé≠ ÂºÄÂßãÁîüÊàêÊ®°ÊãüÈîôÈ¢òÊï∞ÊçÆÔºåÈîôÈ¢òID:', errorId);
            
            try {
                // Ê£ÄÊü•Êú¨Âú∞Â≠òÂÇ®‰∏≠ÊòØÂê¶Â∑≤Ê†áËÆ∞‰∏∫Â∑≤Â§ç‰π†
                const reviewedErrors = JSON.parse(localStorage.getItem('reviewedErrors') || '[]');
                const isReviewedLocal = reviewedErrors.includes(errorId);
                console.log('üìã Êú¨Âú∞Â§ç‰π†Áä∂ÊÄÅ:', isReviewedLocal);
                
                // ÁîüÊàêÊ®°ÊãüÊï∞ÊçÆ
                const mockData = generateMockData(errorId, isReviewedLocal);
                console.log('üé≠ ÁîüÊàêÁöÑÊ®°ÊãüÊï∞ÊçÆ:', mockData);
                
                // ‰øùÂ≠òÂπ∂ÊòæÁ§∫Êï∞ÊçÆ
                errorData = mockData;
                displayErrorDetail(mockData);
                
            } catch (error) {
                console.error('ÁîüÊàêÊ®°ÊãüÊï∞ÊçÆÂ§±Ë¥•:', error);
                showError('Êï∞ÊçÆÁîüÊàêÈîôËØØ', 'Ê®°ÊãüÊï∞ÊçÆÁîüÊàêÂ§±Ë¥•: ' + error.message);
            }
        }

        function generateMockData(id, isReviewed = false) {
            const errorIdNum = parseInt(id) || 1;
            
            // È¢ÑÂÆö‰πâÁöÑÈ¢òÁõÆÊï∞ÊçÆ
            const questionData = [
                {
                    subject: 'math',
                    subjectName: 'Êï∞Â≠¶',
                    difficulty: 'medium',
                    question_text: 'ËÆ°ÁÆóÔºö125 √ó 8 = ?',
                    user_answer: '1024',
                    correct_answer: '1000',
                    explanation: 'ËøôÊòØ‰∏ÄÈÅìÂü∫Êú¨ÁöÑ‰πòÊ≥ïËøêÁÆóÈ¢òÁõÆ„ÄÇÊ≠£Á°ÆÁöÑËÆ°ÁÆóËøáÁ®ãÊòØÔºö125 √ó 8 = 125 √ó (2 √ó 4) = (125 √ó 2) √ó 4 = 250 √ó 4 = 1000„ÄÇ‰Ω†ÁöÑÁ≠îÊ°à1024ÂèØËÉΩÊòØËÆ°ÁÆóËøáÁ®ã‰∏≠Âá∫Áé∞‰∫ÜÈîôËØØÔºåÂª∫ËÆÆÈáçÊñ∞Ê£ÄÊü•ËÆ°ÁÆóÊ≠•È™§„ÄÇ',
                    learning_tips: [
                        '‰ªîÁªÜËøõË°åÊØè‰∏ÄÊ≠•ËÆ°ÁÆóÔºåÈÅøÂÖçÊÄ•Ë∫Å',
                        'ÂèØ‰ª•‰ΩøÁî®ÂàÜËß£Ê≥ïÔºö125 √ó 8 = 125 √ó 2 √ó 4',
                        'È™åÁÆóÊó∂ÂèØ‰ª•Áî®Èô§Ê≥ïÊ£ÄÊü•Ôºö1000 √∑ 8 = 125',
                        'Â§öÁªÉ‰π†Á±ª‰ººÁöÑ‰πòÊ≥ïËøêÁÆóÈ¢òÁõÆ'
                    ]
                },
                {
                    subject: 'chinese',
                    subjectName: 'ËØ≠Êñá',
                    difficulty: 'medium',
                    question_text: '‰∏ãÂàóËØçËØ≠‰∏≠ÔºåÊ≤°ÊúâÈîôÂà´Â≠óÁöÑ‰∏ÄÁªÑÊòØÔºàÔºâ\nA. ÂÜçÊé•ÂÜçÂä±  B. ‰∏çËÉ´ËÄåËµ∞  C. Ë≤åÂêàÁ•ûÁ¶ª  D. Ëµ∞Â§¥Êó†Ë∑Ø',
                    user_answer: 'A',
                    correct_answer: 'C',
                    explanation: 'Ê≠£Á°ÆÁ≠îÊ°àÊòØC„ÄÇAÈ°π"ÂÜçÊé•ÂÜçÂä±"Â∫î‰∏∫"ÂÜçÊé•ÂÜçÂéâ"ÔºõBÈ°π"‰∏çËÉ´ËÄåËµ∞"ÊòØÊ≠£Á°ÆÁöÑÔºõCÈ°π"Ë≤åÂêàÁ•ûÁ¶ª"ÂÜôÊ≥ïÊ≠£Á°ÆÔºåÊåáÂ§ñË°®ÂíåË∞êËÄåÂÜÖÂøÉ‰∏ç‰∏ÄËá¥ÔºõDÈ°π"Ëµ∞Â§¥Êó†Ë∑Ø"Â∫î‰∏∫"Ëµ∞ÊäïÊó†Ë∑Ø"„ÄÇ',
                    learning_tips: [
                        'Ê≥®ÊÑèÂå∫ÂàÜÂΩ¢ËøëÂ≠óÂíåÈü≥ËøëÂ≠ó',
                        'ÁêÜËß£ÊàêËØ≠ÁöÑÊú¨‰πâÔºåÈÅøÂÖçÊúõÊñáÁîü‰πâ',
                        'Â§öÁßØÁ¥ØÂ∏∏Áî®ÊàêËØ≠ÁöÑÊ≠£Á°ÆÂÜôÊ≥ï',
                        'ÈÅáÂà∞‰∏çÁ°ÆÂÆöÁöÑËØçËØ≠Ë¶ÅÊü•Â≠óÂÖ∏Á°ÆËÆ§'
                    ]
                },
                {
                    subject: 'english',
                    subjectName: 'Ëã±ËØ≠',
                    difficulty: 'easy',
                    question_text: 'Choose the correct answer: I _____ to school every day.\nA. go  B. goes  C. going  D. went',
                    user_answer: 'B',
                    correct_answer: 'A',
                    explanation: 'Ê≠£Á°ÆÁ≠îÊ°àÊòØA„ÄÇ‰∏ªËØ≠"I"ÊòØÁ¨¨‰∏Ä‰∫∫Áß∞ÔºåÂú®‰∏ÄËà¨Áé∞Âú®Êó∂‰∏≠Â∫îËØ•‰ΩøÁî®Âä®ËØçÂéüÂΩ¢"go"„ÄÇ"goes"ÊòØÁ¨¨‰∏â‰∫∫Áß∞ÂçïÊï∞ÂΩ¢ÂºèÔºåÁî®‰∫éhe/she/itÁ≠â‰∏ªËØ≠„ÄÇ',
                    learning_tips: [
                        'ÊéåÊè°‰∏ÄËà¨Áé∞Âú®Êó∂ÁöÑÂä®ËØçÂèòÂåñËßÑÂæã',
                        'Âå∫ÂàÜÁ¨¨‰∏Ä„ÄÅ‰∫å„ÄÅ‰∏â‰∫∫Áß∞ÁöÑÂä®ËØçÂΩ¢Âºè',
                        'ËÆ∞‰Ωè‰∏ªË∞ì‰∏ÄËá¥ÁöÑÂü∫Êú¨ÂéüÂàô',
                        'Â§öÂÅöÊó∂ÊÄÅÁªÉ‰π†È¢òÂä†Âº∫ÁêÜËß£'
                    ]
                }
            ];
            
            // Ê†πÊçÆIDÈÄâÊã©È¢òÁõÆ - ‰∏éÂêéÁ´ØÁÆóÊ≥ï‰∏ÄËá¥
            const index = errorIdNum % questionData.length;
            const selectedData = questionData[index];
            
            // ÊûÑÂª∫ÂÆåÊï¥ÁöÑÊ®°ÊãüÊï∞ÊçÆ
            return {
                id: id,
                subject: selectedData.subject,
                subjectName: selectedData.subjectName,
                difficulty: selectedData.difficulty,
                is_reviewed: isReviewed,
                created_at: new Date().toISOString(),
                question_text: selectedData.question_text,
                question_image: null,
                user_answer: selectedData.user_answer,
                correct_answer: selectedData.correct_answer,
                explanation: selectedData.explanation,
                learning_tips: selectedData.learning_tips,
            };
        }

        function displayErrorDetail(data) {
            console.log('üé® ÂºÄÂßãÊòæÁ§∫ÈîôÈ¢òËØ¶ÊÉÖ:', data);
            
            // ÈöêËóèÂä†ËΩΩÁä∂ÊÄÅ
            document.getElementById('loadingSection').style.display = 'none';
            
            // ÊòæÁ§∫ÈîôÈ¢òÂÜÖÂÆπ
            document.getElementById('errorContent').style.display = 'block';
            
            // Êõ¥Êñ∞ÈîôÈ¢ò‰ø°ÊÅØ
            updateErrorInfo(data);
            
            // Êõ¥Êñ∞È¢òÁõÆÂÜÖÂÆπ
            updateQuestionContent(data);
            
            // Êõ¥Êñ∞Êìç‰ΩúÊåâÈíÆ
            updateActionButtons(data);
            
            console.log('‚úÖ ÈîôÈ¢òËØ¶ÊÉÖÊòæÁ§∫ÂÆåÊàê');
        }

        function updateErrorInfo(data) {
            try {
                // ÂèåÂêëÂ≠¶ÁßëÊò†Â∞Ñ - ‰∏éÈîôÈ¢òÊú¨È°µÈù¢‰øùÊåÅ‰∏ÄËá¥
                const subjectMapping = {
                    // Ëã±ÊñáÂà∞‰∏≠Êñá
                    'math': 'Êï∞Â≠¶',
                    'chinese': 'ËØ≠Êñá', 
                    'english': 'Ëã±ËØ≠',
                    'physics': 'Áâ©ÁêÜ',
                    'chemistry': 'ÂåñÂ≠¶',
                    'biology': 'ÁîüÁâ©',
                    // ‰∏≠ÊñáÂà∞Ëã±Êñá
                    'Êï∞Â≠¶': 'math',
                    'ËØ≠Êñá': 'chinese',
                    'Ëã±ËØ≠': 'english',
                    'Áâ©ÁêÜ': 'physics',
                    'ÂåñÂ≠¶': 'chemistry',
                    'ÁîüÁâ©': 'biology'
                };
                
                // ÁßëÁõÆÊ†áÁ≠æ - ‰ºòÂÖà‰ΩøÁî®subjectNameÔºåÁÑ∂ÂêéÊò†Â∞Ñsubject
                const subjectTag = document.getElementById('subjectTag');
                
                // Ëé∑ÂèñÂéüÂßãÂ≠¶ÁßëÊï∞ÊçÆ - ‰ºòÂÖà‰ΩøÁî®subjectNameÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                const rawSubject = data.subjectName || data.subject || 'Êú™Áü•ÁßëÁõÆ';
                console.log('üè∑Ô∏è ÂéüÂßãÂ≠¶ÁßëÊï∞ÊçÆ:', rawSubject);
                
                // Á°ÆÂÆöÊúÄÁªàÊòæÁ§∫ÁöÑÂ≠¶ÁßëÂêçÁß∞Ôºà‰∏≠ÊñáÔºâ
                let subjectName = 'Êú™Áü•ÁßëÁõÆ';
                let subjectCode = 'unknown';
                
                if (rawSubject && subjectMapping[rawSubject]) {
                    // Â¶ÇÊûúËÉΩÂú®Êò†Â∞ÑË°®‰∏≠ÊâæÂà∞ÔºàÊó†ËÆ∫ÊòØ‰∏≠ÊñáËøòÊòØËã±ÊñáÔºâ
                    if (['Êï∞Â≠¶', 'ËØ≠Êñá', 'Ëã±ËØ≠', 'Áâ©ÁêÜ', 'ÂåñÂ≠¶', 'ÁîüÁâ©'].includes(rawSubject)) {
                        // ÂéüÂßãÊï∞ÊçÆÊòØ‰∏≠Êñá
                        subjectName = rawSubject;
                        subjectCode = subjectMapping[rawSubject];
                    } else {
                        // ÂéüÂßãÊï∞ÊçÆÊòØËã±Êñá
                        subjectName = subjectMapping[rawSubject];
                        subjectCode = rawSubject;
                    }
                } else {
                    // Â¶ÇÊûúÊò†Â∞ÑË°®‰∏≠Ê≤°ÊúâÔºåÁõ¥Êé•‰ΩøÁî®ÂéüÂßãÊï∞ÊçÆ
                    subjectName = rawSubject;
                    subjectCode = rawSubject.toLowerCase();
                }
                
                console.log('üé® ÊúÄÁªàÂ≠¶ÁßëÊòæÁ§∫:', { subjectName, subjectCode });
                
                subjectTag.textContent = subjectName;
                subjectTag.className = `subject-tag subject-${subjectCode.toLowerCase()}`;
                
                // ÈöæÂ∫¶Ê†áÁ≠æ
                const difficultyTag = document.getElementById('difficultyTag');
                const difficultyText = {
                    'easy': 'ÁÆÄÂçï',
                    'medium': '‰∏≠Á≠â',
                    'hard': 'Âõ∞Èöæ'
                };
                difficultyTag.textContent = difficultyText[data.difficulty] || data.difficulty || '‰∏≠Á≠â';
                difficultyTag.className = `difficulty-tag difficulty-${data.difficulty || 'medium'}`;
                
                // Â§ç‰π†Áä∂ÊÄÅ
                const statusTag = document.getElementById('statusTag');
                statusTag.textContent = data.is_reviewed ? 'Â∑≤Â§ç‰π†' : 'Êú™Â§ç‰π†';
                statusTag.className = `error-status status-${data.is_reviewed ? 'reviewed' : 'unreviewed'}`;
                
                // ÈîôÈ¢òÊó∂Èó¥
                const errorDate = document.getElementById('errorDate');
                const createdAt = new Date(data.created_at);
                errorDate.textContent = `ÈîôÈ¢òÊó∂Èó¥Ôºö${createdAt.toLocaleDateString()}`;
                
                // Â≠òÂÇ®ÈîôÈ¢òÊï∞ÊçÆ‰æõÂÖ∂‰ªñÂäüËÉΩ‰ΩøÁî®
                window.currentErrorData = {
                    id: data.id,
                    subject: subjectName,
                    difficulty: data.difficulty,
                    reviewed: data.is_reviewed
                };
                
            } catch (error) {
                console.error('Êõ¥Êñ∞ÈîôÈ¢ò‰ø°ÊÅØÂ§±Ë¥•:', error);
            }
        }

        function updateQuestionContent(data) {
            try {
                // È¢òÁõÆÂÜÖÂÆπ
                document.getElementById('questionText').textContent = data.question_text || 'ÊöÇÊó†È¢òÁõÆÂÜÖÂÆπ';
                
                // Áî®Êà∑Á≠îÊ°à
                document.getElementById('userAnswer').textContent = data.user_answer || '-';
                
                // Ê≠£Á°ÆÁ≠îÊ°à
                document.getElementById('correctAnswer').textContent = data.correct_answer || '-';
                
                // ËØ¶ÁªÜËß£Êûê
                document.getElementById('explanationText').textContent = data.explanation || 'ÊöÇÊó†Ëß£ÊûêÂÜÖÂÆπ';
                
                // Â≠¶‰π†Âª∫ËÆÆ
                const tipsList = document.getElementById('tipsList');
                if (data.learning_tips && data.learning_tips.length > 0) {
                    tipsList.innerHTML = data.learning_tips.map(tip => `<li>${tip}</li>`).join('');
                } else {
                    tipsList.innerHTML = '<li>ÊöÇÊó†Â≠¶‰π†Âª∫ËÆÆ</li>';
                }
                
            } catch (error) {
                console.error('Êõ¥Êñ∞È¢òÁõÆÂÜÖÂÆπÂ§±Ë¥•:', error);
            }
        }

        function updateActionButtons(data) {
            const reviewBtn = document.getElementById('reviewBtn');
            if (data.is_reviewed) {
                reviewBtn.textContent = '‚úÖ Â∑≤Â§ç‰π†';
                reviewBtn.disabled = true;
            }
        }

        async function markAsReviewed() {
            try {
                const response = await fetch(`${API_BASE}/student/error-book/${errorId}/review`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    // Êõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ
                    updateReviewStatus(true);
                    showToast('Â∑≤Ê†áËÆ∞‰∏∫Â∑≤Â§ç‰π†', 'success');
                } else {
                    throw new Error('Ê†áËÆ∞Â§±Ë¥•');
                }
            } catch (error) {
                console.error('Ê†áËÆ∞Â§ç‰π†Â§±Ë¥•:', error);
                console.log('‰ΩøÁî®Ê®°ÊãüÊàêÂäüÂ§ÑÁêÜ');
                
                // Ê®°ÊãüÊàêÂäüÂ§ÑÁêÜ - ÂêåÊ†∑Êõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ
                updateReviewStatus(true);
                showToast('Â∑≤Ê†áËÆ∞‰∏∫Â∑≤Â§ç‰π†', 'success');
            }
        }

        function updateReviewStatus(isReviewed) {
            // Êõ¥Êñ∞ÈîôÈ¢òÊï∞ÊçÆ
            errorData.is_reviewed = isReviewed;
            
            // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®
            const reviewedErrors = JSON.parse(localStorage.getItem('reviewedErrors') || '[]');
            if (isReviewed && !reviewedErrors.includes(errorId)) {
                reviewedErrors.push(errorId);
                localStorage.setItem('reviewedErrors', JSON.stringify(reviewedErrors));
            }
            
            // Êõ¥Êñ∞ÁïåÈù¢ÊòæÁ§∫
            updateErrorInfo(errorData);
            updateActionButtons(errorData);
        }

        function practiceSimilar() {
            // Ë∑≥ËΩ¨Âà∞Áõ∏‰ººÈ¢òÁªÉ‰π†È°µÈù¢
            window.location.href = `/frontend/similar-practice.html?errorId=${errorId}`;
        }

        function shareError() {
            // ÂàÜ‰∫´ÈîôÈ¢òÂäüËÉΩ
            showToast('ÂàÜ‰∫´ÂäüËÉΩÂºÄÂèë‰∏≠', 'info');
        }

        function collectError() {
            // Êî∂ËóèÈîôÈ¢òÂäüËÉΩ
            showToast('Êî∂ËóèÂäüËÉΩÂºÄÂèë‰∏≠', 'info');
        }

        function showActions() {
            // ÊòæÁ§∫Êõ¥Â§öÊìç‰Ωú
            showToast('Êõ¥Â§öÊìç‰ΩúÂºÄÂèë‰∏≠', 'info');
        }

        function showError(title, message) {
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('errorContent').style.display = 'none';
            
            const errorSection = document.getElementById('errorSection');
            document.getElementById('errorTitle').textContent = title;
            document.getElementById('errorMessage').textContent = message;
            errorSection.style.display = 'block';
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>