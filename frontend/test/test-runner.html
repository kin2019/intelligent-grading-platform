<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ•™è‚²å¹³å° - å•å…ƒæµ‹è¯•è¿è¡Œå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .test-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .test-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #e2e8f0;
        }

        .result-card.passed {
            border-left-color: #10b981;
            background: #f0fdf4;
        }

        .result-card.failed {
            border-left-color: #ef4444;
            background: #fef2f2;
        }

        .result-card.running {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }

        .result-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-item {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        .issues-list {
            margin-top: 15px;
        }

        .issue-item {
            background: white;
            border-radius: 4px;
            padding: 8px 12px;
            margin: 5px 0;
            font-size: 0.9rem;
            border-left: 3px solid #ef4444;
        }

        .console-output {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            padding: 15px;
            border-radius: 6px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .loading.show {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid #e5e7eb;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .summary-card {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin: 20px 0;
        }

        .summary-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .summary-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
        }

        .summary-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .test-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .test-results {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª å•å…ƒæµ‹è¯•è¿è¡Œå™¨</h1>
            <p>æ­¥éª¤8.4ï¼šå…¨é¢æµ‹è¯• - å•å…ƒæµ‹è¯•æ‰§è¡Œ</p>
        </div>

        <div class="test-card">
            <div class="test-controls">
                <button class="btn btn-primary" onclick="runAllTests()" id="runAllBtn">
                    ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•
                </button>
                <button class="btn btn-secondary" onclick="runQualityTests()" id="qualityBtn">
                    ğŸ“Š è´¨é‡ä¼˜åŒ–å™¨æµ‹è¯•
                </button>
                <button class="btn btn-secondary" onclick="runPerformanceTests()" id="performanceBtn">
                    âš¡ æ€§èƒ½ä¼˜åŒ–å™¨æµ‹è¯•
                </button>
                <button class="btn btn-secondary" onclick="runErrorTests()" id="errorBtn">
                    ğŸ›¡ï¸ é”™è¯¯å¤„ç†å™¨æµ‹è¯•
                </button>
                <button class="btn btn-secondary" onclick="runIntegrationTests()" id="integrationBtn">
                    ğŸ”— é›†æˆæµ‹è¯•
                </button>
                <button class="btn btn-secondary" onclick="runUXTests()" id="uxBtn">
                    ğŸ¨ ç”¨æˆ·ä½“éªŒæµ‹è¯•
                </button>
                <button class="btn btn-secondary" onclick="clearResults()" id="clearBtn">
                    ğŸ—‘ï¸ æ¸…ç©ºç»“æœ
                </button>
            </div>

            <div class="loading" id="loadingIndicator">
                <div class="loading-spinner"></div>
                æ­£åœ¨è¿è¡Œæµ‹è¯•...
            </div>

            <div id="testSummary"></div>

            <div class="test-results" id="testResults">
                <!-- æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>

            <div id="consoleOutput"></div>
        </div>
    </div>

    <!-- å¼•å…¥è¢«æµ‹è¯•çš„ç»„ä»¶ -->
    <script src="/frontend/js/exercise-quality-optimizer.js"></script>
    <script src="/frontend/js/performance-optimizer.js"></script>
    <script src="/frontend/js/error-handler.js"></script>

    <!-- å¼•å…¥æµ‹è¯•æ–‡ä»¶ -->
    <script src="/frontend/test/quality-optimizer-tests.js"></script>
    <script src="/frontend/test/performance-optimizer-tests.js"></script>
    <script src="/frontend/test/error-handler-tests.js"></script>
    <script src="/frontend/test/integration-tests.js"></script>
    <script src="/frontend/test/ux-tests.js"></script>

    <script>
        // å…¨å±€æµ‹è¯•çŠ¶æ€
        let testResults = {
            quality: null,
            performance: null,
            error: null,
            integration: null,
            ux: null
        };

        let consoleMessages = [];

        // æ‹¦æˆªconsole.logç”¨äºæ˜¾ç¤º
        const originalLog = console.log;
        const originalError = console.error;

        console.log = function(...args) {
            consoleMessages.push({ type: 'log', message: args.join(' '), timestamp: Date.now() });
            originalLog.apply(console, args);
            updateConsoleOutput();
        };

        console.error = function(...args) {
            consoleMessages.push({ type: 'error', message: args.join(' '), timestamp: Date.now() });
            originalError.apply(console, args);
            updateConsoleOutput();
        };

        // æ›´æ–°æ§åˆ¶å°è¾“å‡ºæ˜¾ç¤º
        function updateConsoleOutput() {
            const outputEl = document.getElementById('consoleOutput');
            if (consoleMessages.length === 0) {
                outputEl.innerHTML = '';
                return;
            }

            const html = `
                <div class="console-output">
                    ${consoleMessages.slice(-50).map(msg => {
                        const time = new Date(msg.timestamp).toLocaleTimeString();
                        const color = msg.type === 'error' ? '#ff6b6b' : '#00ff00';
                        return `<div style="color: ${color};">[${time}] ${msg.message}</div>`;
                    }).join('')}
                </div>
            `;
            outputEl.innerHTML = html;
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function setLoading(loading) {
            const loadingEl = document.getElementById('loadingIndicator');
            const buttons = document.querySelectorAll('.btn');
            
            if (loading) {
                loadingEl.classList.add('show');
                buttons.forEach(btn => btn.disabled = true);
            } else {
                loadingEl.classList.remove('show');
                buttons.forEach(btn => btn.disabled = false);
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            console.log('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•');
            setLoading(true);
            consoleMessages = []; // æ¸…ç©ºæ§åˆ¶å°æ¶ˆæ¯
            
            try {
                // æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰æµ‹è¯•
                await runQualityTests(false);
                await runPerformanceTests(false);
                await runErrorTests(false);
                await runIntegrationTests(false);
                await runUXTests(false);
                
                // æ˜¾ç¤ºæ€»ç»“
                showOverallSummary();
                
            } catch (error) {
                console.error('è¿è¡Œæµ‹è¯•æ—¶å‘ç”Ÿé”™è¯¯:', error);
            } finally {
                setLoading(false);
            }
        }

        // è¿è¡Œè´¨é‡ä¼˜åŒ–å™¨æµ‹è¯•
        async function runQualityTests(standalone = true) {
            if (standalone) {
                setLoading(true);
                consoleMessages = [];
            }
            
            console.log('ğŸ“Š å¼€å§‹è´¨é‡ä¼˜åŒ–å™¨æµ‹è¯•');
            
            try {
                if (typeof runQualityOptimizerTests === 'function') {
                    testResults.quality = await runQualityOptimizerTests();
                    updateTestResult('quality', testResults.quality);
                } else {
                    console.error('è´¨é‡ä¼˜åŒ–å™¨æµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°');
                    updateTestResult('quality', { error: 'æµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°' });
                }
            } catch (error) {
                console.error('è´¨é‡ä¼˜åŒ–å™¨æµ‹è¯•å¤±è´¥:', error);
                updateTestResult('quality', { error: error.message });
            } finally {
                if (standalone) {
                    setLoading(false);
                }
            }
        }

        // è¿è¡Œæ€§èƒ½ä¼˜åŒ–å™¨æµ‹è¯•
        async function runPerformanceTests(standalone = true) {
            if (standalone) {
                setLoading(true);
                consoleMessages = [];
            }
            
            console.log('âš¡ å¼€å§‹æ€§èƒ½ä¼˜åŒ–å™¨æµ‹è¯•');
            
            try {
                if (typeof runPerformanceOptimizerTests === 'function') {
                    testResults.performance = await runPerformanceOptimizerTests();
                    updateTestResult('performance', testResults.performance);
                } else {
                    console.error('æ€§èƒ½ä¼˜åŒ–å™¨æµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°');
                    updateTestResult('performance', { error: 'æµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°' });
                }
            } catch (error) {
                console.error('æ€§èƒ½ä¼˜åŒ–å™¨æµ‹è¯•å¤±è´¥:', error);
                updateTestResult('performance', { error: error.message });
            } finally {
                if (standalone) {
                    setLoading(false);
                }
            }
        }

        // è¿è¡Œé”™è¯¯å¤„ç†å™¨æµ‹è¯•
        async function runErrorTests(standalone = true) {
            if (standalone) {
                setLoading(true);
                consoleMessages = [];
            }
            
            console.log('ğŸ›¡ï¸ å¼€å§‹é”™è¯¯å¤„ç†å™¨æµ‹è¯•');
            
            try {
                if (typeof runErrorHandlerTests === 'function') {
                    testResults.error = await runErrorHandlerTests();
                    updateTestResult('error', testResults.error);
                } else {
                    console.error('é”™è¯¯å¤„ç†å™¨æµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°');
                    updateTestResult('error', { error: 'æµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°' });
                }
            } catch (error) {
                console.error('é”™è¯¯å¤„ç†å™¨æµ‹è¯•å¤±è´¥:', error);
                updateTestResult('error', { error: error.message });
            } finally {
                if (standalone) {
                    setLoading(false);
                }
            }
        }

        // è¿è¡Œé›†æˆæµ‹è¯•
        async function runIntegrationTests(standalone = true) {
            if (standalone) {
                setLoading(true);
                consoleMessages = [];
            }
            
            console.log('ğŸ”— å¼€å§‹é›†æˆæµ‹è¯•');
            
            try {
                if (typeof runIntegrationTests === 'function') {
                    testResults.integration = await window.runIntegrationTests();
                    updateTestResult('integration', testResults.integration);
                } else {
                    console.error('é›†æˆæµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°');
                    updateTestResult('integration', { error: 'æµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°' });
                }
            } catch (error) {
                console.error('é›†æˆæµ‹è¯•å¤±è´¥:', error);
                updateTestResult('integration', { error: error.message });
            } finally {
                if (standalone) {
                    setLoading(false);
                }
            }
        }

        // è¿è¡Œç”¨æˆ·ä½“éªŒæµ‹è¯•
        async function runUXTests(standalone = true) {
            if (standalone) {
                setLoading(true);
                consoleMessages = [];
            }
            
            console.log('ğŸ¨ å¼€å§‹ç”¨æˆ·ä½“éªŒæµ‹è¯•');
            
            try {
                if (typeof window.runUXTests === 'function') {
                    testResults.ux = await window.runUXTests();
                    updateTestResult('ux', testResults.ux);
                } else {
                    console.error('ç”¨æˆ·ä½“éªŒæµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°');
                    updateTestResult('ux', { error: 'æµ‹è¯•å‡½æ•°æœªæ‰¾åˆ°' });
                }
            } catch (error) {
                console.error('ç”¨æˆ·ä½“éªŒæµ‹è¯•å¤±è´¥:', error);
                updateTestResult('ux', { error: error.message });
            } finally {
                if (standalone) {
                    setLoading(false);
                }
            }
        }

        // æ›´æ–°æµ‹è¯•ç»“æœæ˜¾ç¤º
        function updateTestResult(type, result) {
            const resultsContainer = document.getElementById('testResults');
            const typeNames = {
                quality: 'è´¨é‡ä¼˜åŒ–å™¨',
                performance: 'æ€§èƒ½ä¼˜åŒ–å™¨',
                error: 'é”™è¯¯å¤„ç†å™¨',
                integration: 'é›†æˆæµ‹è¯•',
                ux: 'ç”¨æˆ·ä½“éªŒæµ‹è¯•'
            };
            
            const typeIcons = {
                quality: 'ğŸ“Š',
                performance: 'âš¡',
                error: 'ğŸ›¡ï¸',
                integration: 'ğŸ”—',
                ux: 'ğŸ¨'
            };
            
            let cardClass = 'result-card';
            let statusIcon = 'â³';
            let statusText = 'è¿è¡Œä¸­';
            
            if (result.error) {
                cardClass += ' failed';
                statusIcon = 'âŒ';
                statusText = 'é”™è¯¯';
            } else if (result.failed > 0) {
                cardClass += ' failed';
                statusIcon = 'âŒ';
                statusText = `${result.failed} å¤±è´¥`;
            } else {
                cardClass += ' passed';
                statusIcon = 'âœ…';
                statusText = 'å…¨éƒ¨é€šè¿‡';
            }
            
            const html = `
                <div class="${cardClass}" id="result-${type}">
                    <div class="result-title">
                        ${typeIcons[type]} ${typeNames[type]} ${statusIcon}
                    </div>
                    
                    ${result.error ? `
                        <div style="color: #ef4444; margin: 10px 0;">
                            é”™è¯¯: ${result.error}
                        </div>
                    ` : `
                        <div class="result-stats">
                            <div class="stat-item">
                                <div class="stat-number" style="color: #10b981;">${result.passed}</div>
                                <div class="stat-label">é€šè¿‡</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" style="color: ${result.failed > 0 ? '#ef4444' : '#6b7280'};">${result.failed}</div>
                                <div class="stat-label">å¤±è´¥</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" style="color: #3b82f6;">${result.total}</div>
                                <div class="stat-label">æ€»è®¡</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; color: #666; font-size: 0.9rem;">
                            æˆåŠŸç‡: ${result.successRate ? result.successRate.toFixed(1) : '0'}%
                        </div>
                    `}
                    
                    ${result.issues && result.issues.length > 0 ? `
                        <div class="issues-list">
                            <strong style="color: #ef4444;">å‘ç°çš„é—®é¢˜:</strong>
                            ${result.issues.map(issue => `
                                <div class="issue-item">${issue}</div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            
            // æ›´æ–°æˆ–æ·»åŠ ç»“æœå¡ç‰‡
            const existingCard = document.getElementById(`result-${type}`);
            if (existingCard) {
                existingCard.outerHTML = html;
            } else {
                resultsContainer.innerHTML += html;
            }
        }

        // æ˜¾ç¤ºæ€»ä½“æµ‹è¯•æ€»ç»“
        function showOverallSummary() {
            const summaryContainer = document.getElementById('testSummary');
            
            if (!testResults.quality && !testResults.performance && !testResults.error) {
                summaryContainer.innerHTML = '';
                return;
            }
            
            let totalTests = 0;
            let totalPassed = 0;
            let totalFailed = 0;
            let totalIssues = 0;
            
            Object.values(testResults).forEach(result => {
                if (result && !result.error) {
                    totalTests += result.total || 0;
                    totalPassed += result.passed || 0;
                    totalFailed += result.failed || 0;
                    totalIssues += (result.issues || []).length;
                }
            });
            
            const overallSuccessRate = totalTests > 0 ? ((totalPassed / totalTests) * 100).toFixed(1) : 0;
            
            const html = `
                <div class="summary-card">
                    <div class="summary-title">ğŸ“Š æµ‹è¯•æ€»ç»“æŠ¥å‘Š</div>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-number">${totalTests}</div>
                            <div class="summary-label">æ€»æµ‹è¯•æ•°</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number">${totalPassed}</div>
                            <div class="summary-label">é€šè¿‡</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number">${totalFailed}</div>
                            <div class="summary-label">å¤±è´¥</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number">${overallSuccessRate}%</div>
                            <div class="summary-label">æˆåŠŸç‡</div>
                        </div>
                    </div>
                    ${totalIssues > 0 ? `<div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.9;">å‘ç° ${totalIssues} ä¸ªé—®é¢˜éœ€è¦ä¿®å¤</div>` : ''}
                </div>
            `;
            
            summaryContainer.innerHTML = html;
        }

        // æ¸…ç©ºæµ‹è¯•ç»“æœ
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('testSummary').innerHTML = '';
            document.getElementById('consoleOutput').innerHTML = '';
            consoleMessages = [];
            testResults = { quality: null, performance: null, error: null, integration: null, ux: null };
            console.log('ğŸ“‹ æµ‹è¯•ç»“æœå·²æ¸…ç©º');
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª æ™ºèƒ½æ•™è‚²å¹³å°æµ‹è¯•è¿è¡Œå™¨å·²å‡†å¤‡å°±ç»ª');
            console.log('ğŸ“‹ å¯ç”¨æµ‹è¯•å¥—ä»¶:');
            console.log('  - ğŸ“Š è´¨é‡ä¼˜åŒ–å™¨æµ‹è¯• (exercise-quality-optimizer.js)');
            console.log('  - âš¡ æ€§èƒ½ä¼˜åŒ–å™¨æµ‹è¯• (performance-optimizer.js)');
            console.log('  - ğŸ›¡ï¸ é”™è¯¯å¤„ç†å™¨æµ‹è¯• (error-handler.js)');
            console.log('  - ğŸ”— é›†æˆæµ‹è¯• (integration-tests.js)');
            console.log('  - ğŸ¨ ç”¨æˆ·ä½“éªŒæµ‹è¯• (ux-tests.js)');
            console.log('ğŸš€ ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹å…¨é¢æµ‹è¯•ï¼Œæˆ–å•ç‹¬è¿è¡Œå„æ¨¡å—æµ‹è¯•');
            console.log('ğŸ“Š æµ‹è¯•è¦†ç›–: å•å…ƒæµ‹è¯• â†’ é›†æˆæµ‹è¯• â†’ ç”¨æˆ·ä½“éªŒæµ‹è¯•');
        });
    </script>
</body>
</html>