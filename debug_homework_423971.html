<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•ä½œä¸š423971 - "ä½¿ç”¨æœåŠ¡å™¨æ•°æ®"é—®é¢˜</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .debug-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 8px;
            background: #f9f9f9;
        }
        .result { 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .button { 
            padding: 10px 16px; 
            margin: 5px; 
            background: #007AFF; 
            color: white; 
            border: none;
            border-radius: 4px; 
            cursor: pointer;
        }
        .button:hover { background: #0056CC; }
    </style>
</head>
<body>
    <h1>ğŸ” è°ƒè¯•ä½œä¸šID 423971 - "ä½¿ç”¨æœåŠ¡å™¨æ•°æ®"é—®é¢˜</h1>
    
    <div class="debug-section">
        <h3>é—®é¢˜æè¿°</h3>
        <div class="error">
            <strong>é—®é¢˜ï¼š</strong> ä½œä¸šID 423971 æ˜¾ç¤º"ä½¿ç”¨æœåŠ¡å™¨æ•°æ®"ï¼Œä½†APIåº”è¯¥è¿”å›403é”™è¯¯
        </div>
    </div>

    <div class="debug-section">
        <h3>è°ƒè¯•æ­¥éª¤</h3>
        <button onclick="debugAPI()" class="button">1ï¸âƒ£ æµ‹è¯•APIå“åº”</button>
        <button onclick="debugFrontend()" class="button">2ï¸âƒ£ æ¨¡æ‹Ÿå‰ç«¯é€»è¾‘</button>
        <button onclick="debugFullFlow()" class="button">3ï¸âƒ£ å®Œæ•´æµç¨‹è°ƒè¯•</button>
        <div id="debugResults"></div>
    </div>

    <div class="debug-section">
        <h3>å¿«é€Ÿé“¾æ¥</h3>
        <a href="http://localhost:8000/frontend/homework-result.html?id=423971" class="button" target="_blank">ğŸ“Š æŸ¥çœ‹é—®é¢˜é¡µé¢</a>
    </div>

    <script>
        const homeworkId = 423971;
        const API_BASE = 'http://localhost:8000/api/v1';

        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('debugResults');
            const logDiv = document.createElement('div');
            logDiv.className = `result ${type}`;
            logDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            resultsDiv.appendChild(logDiv);
        }

        async function debugAPI() {
            log('å¼€å§‹æµ‹è¯•APIå“åº”...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/homework/result/${homeworkId}`);
                log(`APIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, 'info');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`APIæ•°æ®: ${JSON.stringify(data, null, 2)}`, 'success');
                    log('âœ… APIè°ƒç”¨æˆåŠŸ - è¿™å¯èƒ½æ˜¯"ä½¿ç”¨æœåŠ¡å™¨æ•°æ®"çš„åŸå› ', 'success');
                } else {
                    const errorData = await response.json();
                    log(`APIé”™è¯¯æ•°æ®: ${JSON.stringify(errorData, null, 2)}`, 'error');
                    log(`âŒ APIè°ƒç”¨å¤±è´¥ (${response.status}) - åº”è¯¥ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®`, 'error');
                }
            } catch (error) {
                log(`APIè°ƒç”¨å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function debugFrontend() {
            log('æ¨¡æ‹Ÿå‰ç«¯æ•°æ®å¤„ç†é€»è¾‘...', 'info');
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            let finalData = { id: homeworkId, subject: 'fallback' }; // é»˜è®¤fallbackæ•°æ®
            
            try {
                const response = await fetch(`${API_BASE}/homework/result/${homeworkId}`);
                
                if (response.ok) {
                    try {
                        const apiData = await response.json();
                        log(`APIè¿”å›æ•°æ®: ${JSON.stringify(apiData)}`, 'info');
                        
                        // æ¨¡æ‹Ÿå‰ç«¯çš„æ£€æŸ¥æ¡ä»¶
                        if (apiData && (apiData.subject || apiData.id)) {
                            log('âœ… æ•°æ®é€šè¿‡éªŒè¯: apiData.subject=' + apiData.subject + ', apiData.id=' + apiData.id, 'success');
                            finalData = apiData;
                            log('ğŸ¯ è¿™é‡Œä¼šæ˜¾ç¤º"ä½¿ç”¨æœåŠ¡å™¨æ•°æ®"', 'warning');
                        } else {
                            log('âŒ æ•°æ®æœªé€šè¿‡éªŒè¯', 'error');
                            log('ä¼šæ˜¾ç¤º"APIæ•°æ®ä¸å®Œæ•´ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®"', 'info');
                        }
                    } catch (parseError) {
                        log(`JSONè§£æå¤±è´¥: ${parseError.message}`, 'error');
                        log('ä¼šæ˜¾ç¤º"æ•°æ®è§£æå¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®"', 'info');
                    }
                } else {
                    log(`APIè°ƒç”¨å¤±è´¥ (${response.status})`, 'error');
                    if (response.status === 403) {
                        log('ä¼šæ˜¾ç¤º"æœªç™»å½•ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®å±•ç¤º"', 'info');
                    }
                }
            } catch (error) {
                log(`ç½‘ç»œå¼‚å¸¸: ${error.message}`, 'error');
                log('ä¼šæ˜¾ç¤º"ç½‘ç»œå¼‚å¸¸ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®"', 'info');
            }
            
            log(`æœ€ç»ˆæ•°æ®: ${JSON.stringify(finalData)}`, 'info');
        }

        async function debugFullFlow() {
            log('=== å¼€å§‹å®Œæ•´æµç¨‹è°ƒè¯• ===', 'info');
            
            // æ£€æŸ¥è®¡ç®—çš„å­¦ç§‘
            const subjects = ['chinese', 'math', 'english', 'physics', 'chemistry', 'biology'];
            const subjectIndex = homeworkId % subjects.length;
            log(`ä½œä¸šID ${homeworkId} ç®—æ³•è®¡ç®—å­¦ç§‘: ${homeworkId} % ${subjects.length} = ${subjectIndex} -> ${subjects[subjectIndex]}`, 'info');
            
            // æ£€æŸ¥æ˜¯å¦åœ¨ç‰¹æ®Šå¤„ç†èŒƒå›´å†…
            const specialIds = [898411, 773191, 899573, 942516, 942737];
            const isSpecial = specialIds.includes(homeworkId);
            log(`æ˜¯å¦æœ‰ç‰¹æ®Šå¤„ç†: ${isSpecial}`, 'info');
            
            // æ¨¡æ‹Ÿåç«¯é€»è¾‘
            log('åç«¯ä¼šå°è¯•æŸ¥è¯¢æ•°æ®åº“ï¼Œä½†éœ€è¦è®¤è¯', 'info');
            log('å¦‚æœè®¤è¯å¤±è´¥ï¼Œè¿”å›403', 'info');
            log('å¦‚æœè®¤è¯æˆåŠŸä½†æ²¡æœ‰æ•°æ®ï¼Œç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®', 'info');
            
            // å®é™…æµ‹è¯•
            await debugAPI();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await debugFrontend();
            
            log('=== è°ƒè¯•å®Œæˆ ===', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºæœ¬è°ƒè¯•
        window.onload = function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è°ƒè¯•ä½œä¸šID 423971', 'info');
            setTimeout(debugAPI, 500);
        };
    </script>
</body>
</html>